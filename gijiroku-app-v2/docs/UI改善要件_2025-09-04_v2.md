# UI改善要件書 v2.0 - 2025年9月4日

## 📋 改善要件まとめ（補足反映版）

### 1. レイアウト・配置の改善
- **AI修正実行セクションの配置変更**: 現在の下部から上部（プロンプト選択の下）に移動
- **余白スペースの有効活用**: テンプレート表示エリアの余白を削除し、コンテンツを上に配置
- **テンプレート表示のポップアップ化**: 現在のテンプレート表示を下部から独立したポップアップウィンドウに変更

### 2. 画像管理機能の強化
- **画像確認ボタンの機能拡張**: 「👁️ 画像確認」から「📋 画像一覧」機能に変更
- **画像名前一覧表示**: 挿入済み画像のファイル名リストを表示
- **個別画像削除機能**: リストから選択して特定の画像を削除可能
- **⚠️ 重要な補足**: 
  - 表示範囲を適切に制御（プルダウン形式で表示領域を管理）
  - サムネイル画像と削除ボタンを含む一覧表示
  - 表示がしづらくなることを避けるためのUI設計に注意

### 3. PDF機能の強化
- **PDFプレビュー機能**: 「PDFダウンロード」ボタンの横に「🔍 PDFプレビュー」ボタンを追加
- **ダウンロード前確認**: PDF内容をプレビューしてからダウンロード可能
- **⚠️ 重要な補足**:
  - 標準PDF・LaTeX形式両方のプレビュー対応
  - Mermaid機能も含めて両フォーマットでプレビュー可能

## 🎯 実装優先度（補足反映）

### 高優先度 (Phase 1) 
1. AI修正実行セクションの配置変更
2. 余白スペースの削除・レイアウト調整
3. **レイアウト干渉チェック**: 他の要素への影響確認

### 中優先度 (Phase 2)
4. 画像一覧・削除機能の実装（UI制約考慮）
5. PDFプレビュー機能の追加（両フォーマット対応）

### 低優先度 (Phase 3)
6. テンプレート表示のポップアップ化

## 📐 技術実装チェックリスト（補足対応版）

### Phase 1: レイアウト調整 + 干渉チェック
- [ ] `DashboardRefactored.tsx` の構造変更
  - [ ] AI修正実行セクション(`AIExecutionSection`)を上部に移動
  - [ ] プロンプト選択とAI修正実行の間の余白を調整
  - [ ] 下部の空白スペースを削除
- [ ] **レイアウト干渉チェック**
  - [ ] 他のコンポーネントとの配置競合確認
  - [ ] レスポンシブ表示での崩れ確認
  - [ ] スクロール動作への影響確認
- [ ] CSS/スタイル調整
  - [ ] 各セクション間のマージン・パディング調整
  - [ ] レスポンシブ対応の確認
- [ ] **Playwright E2Eテスト実行**
  - [ ] レイアウト変更後の動作確認テスト
  - [ ] 全機能の正常動作確認

### Phase 2: 機能拡張（制約対応版）
- [ ] 画像管理機能強化（表示制約対応）
  - [ ] `EditorSection.tsx` の画像確認ボタン修正
  - [ ] **プルダウン式画像一覧コンポーネント作成**
    - [ ] 表示範囲を制御可能な一覧UI
    - [ ] サムネイル表示機能
    - [ ] 個別削除ボタン実装
  - [ ] 画像メタデータ管理（ファイル名保持）
  - [ ] **表示しづらさ回避のUX設計**
    - [ ] 適切なサイジング
    - [ ] スクロール対応
    - [ ] コンテンツ重複回避
- [ ] PDFプレビュー機能（全フォーマット対応）
  - [ ] `PdfDownloadButton.tsx` にプレビューボタン追加
  - [ ] **マルチフォーマット対応プレビュー**
    - [ ] 標準PDFプレビュー表示
    - [ ] LaTeX形式プレビュー表示
    - [ ] Mermaidチャート含むプレビュー
  - [ ] PDFプレビュー用モーダル/ダイアログ作成
  - [ ] プレビュー表示ロジック実装
- [ ] **Playwright E2Eテスト実行**
  - [ ] 画像一覧表示・削除機能テスト
  - [ ] PDFプレビュー表示テスト（全フォーマット）
  - [ ] 画像を含むPDFプレビュー確認

### Phase 3: 高度なUI改善
- [ ] テンプレートポップアップ化
  - [ ] `PromptSelector.tsx` のテンプレート表示部分を分離
  - [ ] モーダル/ポップアップコンポーネント作成
  - [ ] テンプレート選択UXの改善
- [ ] **Playwright E2Eテスト実行**
  - [ ] ポップアップ表示・操作性テスト
  - [ ] モーダルのアクセシビリティ確認

## 📝 実装詳細計画（補足対応）

### 1. AI修正実行セクションの移動

**対象ファイル**: `app/src/renderer/components/DashboardRefactored.tsx`

**変更内容**:
```tsx
// 現在の構造
<InputSection />
<PromptSelector />
<!-- 余白エリア -->
<EditorSection />
<AIExecutionSection />

// 変更後の構造
<InputSection />
<PromptSelector />
<AIExecutionSection />  <!-- ここに移動 -->
<EditorSection />
```

**干渉チェック項目**:
- AI修正実行の状態表示がEditorSectionと競合しないか
- プロンプト選択との間隔が適切か
- レスポンシブ時のレイアウト崩れ

### 2. 画像一覧機能の実装（表示制約対応）

**新規コンポーネント**: `ImageListDropdown.tsx`

**機能仕様**:
- **プルダウン式一覧表示**
  - クリック時に展開する一覧
  - 表示範囲を制御（最大高さ設定）
  - スクロール対応
- **サムネイル+削除ボタン構成**
  - 各画像にサムネイル（例：60x40px）
  - ファイル名表示
  - 個別削除ボタン
- **UI制約対応**
  - コンテンツ領域の侵害防止
  - 他要素との重複回避
  - アクセシビリティ対応

**実装例**:
```tsx
<div className="image-list-dropdown">
  <button onClick={toggleDropdown} className="dropdown-trigger">
    📋 画像一覧 ({imageCount}個)
  </button>
  {isOpen && (
    <div className="dropdown-content" style={{ maxHeight: '200px', overflow: 'auto' }}>
      {images.map(image => (
        <div key={image.id} className="image-item">
          <img src={image.thumbnail} alt={image.name} className="thumbnail" />
          <span className="filename">{image.name}</span>
          <button onClick={() => deleteImage(image.id)} className="delete-btn">🗑️</button>
        </div>
      ))}
    </div>
  )}
</div>
```

### 3. PDFプレビュー機能（全フォーマット対応）

**対象ファイル**: `app/src/renderer/components/PdfDownloadButton.tsx`

**実装方式**:
- **マルチフォーマット対応**
  - `standard`形式のHTMLプレビュー
  - `latex`形式のHTMLプレビュー
  - Mermaid図表を含むプレビュー対応
- **プレビュー表示**
  - 新しいウィンドウまたはモーダル
  - 印刷時と同等の表示
  - ズーム・スクロール機能

## ⚠️ 重要な実装注意点

### 画像一覧UI設計
- **表示範囲制御**: 他のコンテンツを隠さない設計
- **パフォーマンス**: 大量画像時の描画最適化
- **UX**: 直感的な操作性確保

### PDFプレビュー実装
- **フォーマット判定**: ユーザー選択に応じた適切なプレビュー
- **Mermaid対応**: チャートが正しく描画されることを確認
- **エラーハンドリング**: プレビュー失敗時の適切な表示

### レイアウト干渉対策
- **段階的確認**: 各変更後に他要素への影響をチェック
- **回帰テスト**: 既存機能が正常動作することを確認
- **ブラウザ互換性**: 異なる画面サイズでの表示確認

## 🧪 テスト計画（E2E重点）

### 必須E2Eテスト項目
各Phase完了時に以下を実行：

**Phase 1**:
```bash
npm run test:e2e -- --grep "レイアウト"
```
- [ ] AI修正実行セクション移動後の動作確認
- [ ] レスポンシブ表示での崩れなし
- [ ] 既存機能への影響なし

**Phase 2**:
```bash
npm run test:e2e -- --grep "画像|PDF"
```
- [ ] 画像一覧表示・操作テスト
- [ ] PDFプレビュー（標準・LaTeX両方）テスト
- [ ] Mermaid含むプレビューテスト

**Phase 3**:
```bash
npm run test:e2e -- --grep "テンプレート|ポップアップ"
```
- [ ] ポップアップ表示・操作テスト
- [ ] モーダルアクセシビリティテスト

## ⏰ 実装スケジュール

| Phase | 作業内容 | 予想工数 | 優先度 | E2Eテスト |
|-------|----------|----------|---------|-----------|
| Phase 1 | レイアウト調整+干渉チェック | 3-4時間 | 🔴 最高 | 必須 |
| Phase 2 | 機能拡張（制約対応） | 5-6時間 | 🟡 高 | 必須 |
| Phase 3 | UI高度化 | 3-4時間 | 🟢 中 | 推奨 |

---
**作成日**: 2025年9月4日  
**更新者**: Claude Code Assistant  
**バージョン**: v2.0（補足反映版）  
**最終更新**: 2025年9月4日 06:50
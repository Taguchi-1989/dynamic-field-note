# è­°äº‹éŒ²ã‚¢ãƒ—ãƒª v2 - é–‹ç™ºä»•æ§˜æ›¸ & Claude Code çµ±åˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

> **æ¦‚è¦**: ã“ã®æ–‡æ›¸ã¯ gijiroku-app-v2 ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®é–‹ç™ºä»•æ§˜æ›¸ã¨å®Ÿè£…ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³ã€Single Source of Truth ã¨ã—ã¦ä½œæˆã•ã‚ŒãŸ Claude Code çµ±åˆç”¨ã®åŒ…æ‹¬çš„ãªãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ã™ã€‚

---

## ç›®æ¬¡

1. [ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦](#1-ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦)
2. [ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆãƒ»ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£](#2-ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£)
3. [ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ](#3-ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ )
4. [å®Ÿè£…ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹](#4-å®Ÿè£…ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹)
5. [æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯ä»•æ§˜](#5-æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯ä»•æ§˜)
6. [ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ§‹æˆ](#6-ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ§‹æˆ)
7. [APIãƒ»IPCé€šä¿¡ä»•æ§˜](#7-apiipcé€šä¿¡ä»•æ§˜)
8. [AIå‡¦ç†ã‚·ã‚¹ãƒ†ãƒ ](#8-aiå‡¦ç†ã‚·ã‚¹ãƒ†ãƒ )
9. [PDFç”Ÿæˆãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³](#9-pdfç”Ÿæˆãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³)
10. [ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å®Ÿè£…](#10-ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å®Ÿè£…)
11. [é–‹ç™ºã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³](#11-é–‹ç™ºã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³)
12. [ãƒ†ã‚¹ãƒˆæˆ¦ç•¥](#12-ãƒ†ã‚¹ãƒˆæˆ¦ç•¥)
13. [å®Ÿè£…é€²æ—ç®¡ç†](#13-å®Ÿè£…é€²æ—ç®¡ç†)
14. [æ—¢çŸ¥ã®å•é¡Œã¨è§£æ±ºç­–](#14-æ—¢çŸ¥ã®å•é¡Œã¨è§£æ±ºç­–)
15. [é‹ç”¨ãƒ»ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹](#15-é‹ç”¨ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹)

---

## 1. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦

### 1.1 åŸºæœ¬æƒ…å ±
- **ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå**: è­°äº‹éŒ²ã‚¢ãƒ—ãƒª v2 (gijiroku-app-v2)
- **ç›®çš„**: éŸ³å£°ã‹ã‚‰AIå‡¦ç†ã«ã‚ˆã‚‹è‡ªå‹•è­°äº‹éŒ²ç”Ÿæˆãƒ»ç·¨é›†ãƒ»å‡ºåŠ›ã‚·ã‚¹ãƒ†ãƒ 
- **å¯¾è±¡ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ **: Electron (Windows/macOS/Linuxå¯¾å¿œ)
- **é–‹ç™ºé–‹å§‹**: 2025å¹´8æœˆ
- **é€²æ—çŠ¶æ³**: Phase 1-3å®Œäº†ã€95%å®Ÿè£…æ¸ˆã¿

### 1.2 ä¸»è¦æ©Ÿèƒ½
1. **VTTãƒ•ã‚¡ã‚¤ãƒ«å…¥åŠ›ãƒ»è§£æ**: éŸ³å£°æ–‡å­—èµ·ã“ã—çµæœã®å–ã‚Šè¾¼ã¿ãƒ»åˆ†å‰²å‡¦ç†
2. **AIè­°äº‹éŒ²ä½œæˆ**: å®Œå…¨ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ã§ã®å†…å®¹æ•´å½¢ãƒ»åˆ†å‰²å‡¦ç†å¯¾å¿œ
3. **Markdownç·¨é›†**: ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ä»˜ãã‚¨ãƒ‡ã‚£ã‚¿
4. **é«˜å“è³ªPDFç”Ÿæˆ**: æ•°å¼ãƒ»å›³è¡¨å¯¾å¿œã®PDFå‡ºåŠ›
5. **ãƒ­ãƒ¼ã‚«ãƒ«ãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆ**: ã‚ªãƒ•ãƒ©ã‚¤ãƒ³å‹•ä½œå„ªå…ˆã®è¨­è¨ˆ
6. **ãƒãƒ¼ã‚¿ãƒ–ãƒ«é‹ç”¨**: ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹å˜ä½ã®å®Œå…¨ç‹¬ç«‹å‹•ä½œ

### 1.2.1 VTTåˆ†å‰²å‡¦ç†æ©Ÿèƒ½ â˜…NEWâ˜…
- **åˆ†å‰²å‡¦ç†**: 5000æ–‡å­—å˜ä½ã§ã®è‡ªå‹•åˆ†å‰²ï¼ˆè¨­å®šå¯èƒ½ï¼‰
- **ã‚ªãƒ¼ãƒãƒ¼ãƒ©ãƒƒãƒ—**: 100æ–‡å­—é‡è¤‡ã§å†…å®¹æ¬ è½é˜²æ­¢
- **é€²æ—è¡¨ç¤º**: ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å‡¦ç†çŠ¶æ³ã®1è¡Œè¡¨ç¤º
- **çµ±åˆå‡¦ç†**: åˆ†å‰²çµæœã®è‡ªç„¶ãªçµåˆãƒ»é‡è¤‡é™¤å»
- **è¨­å®šç®¡ç†**: åˆ†å‰²ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®æ°¸ç¶šåŒ–ç®¡ç†

### 1.3 ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ç‰¹å¾´
- **å®Œå…¨ã‚ªãƒ•ãƒ©ã‚¤ãƒ³å‹•ä½œ**: ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆæ¥ç¶šä¸è¦ã®ãƒ­ãƒ¼ã‚«ãƒ«å‡¦ç†
- **ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹è¨­è¨ˆ**: workspace/ãƒ•ã‚©ãƒ«ãƒ€å˜ä½ã§ã®è¨­å®šç®¡ç†
- **é«˜å“è³ªPDF**: KaTeXæ•°å¼ãƒ»Mermaidå›³è¡¨å¯¾å¿œã®ãƒ“ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ•ãƒ«å‡ºåŠ›
- **å¤šæ®µãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯**: å¤–éƒ¨APIãƒ»ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯éšœå®³ã¸ã®å¯¾å¿œ
- **ã‚»ã‚­ãƒ¥ã‚¢èªè¨¼æ©Ÿæ§‹**: keytaråˆ©ç”¨ã®OSçµ±åˆèªè¨¼

---

## 2. ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆãƒ»ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### 2.1 å…¨ä½“ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆ
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Electron Application                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  React Renderer Process (UI)                           â”‚
â”‚  â”œâ”€â”€â”€ DashboardRefactored.tsx (ãƒ¡ã‚¤ãƒ³ç”»é¢)               â”‚
â”‚  â”œâ”€â”€â”€ FileUpload Section (VTTãƒ•ã‚¡ã‚¤ãƒ«å‡¦ç†)                â”‚
â”‚  â”œâ”€â”€â”€ AIExecution Section (AIå‡¦ç†å®Ÿè¡Œ)                   â”‚
â”‚  â”œâ”€â”€â”€ Editor Section (Markdownç·¨é›†ãƒ»ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼)           â”‚
â”‚  â””â”€â”€â”€ Settings Modal (è¨­å®šç®¡ç†)                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  IPC Communication Layer (å‹å®‰å…¨ãªzodæ¤œè¨¼)              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Main Process Services (Node.js)                       â”‚
â”‚  â”œâ”€â”€â”€ WorkspaceService (ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ç®¡ç†)               â”‚
â”‚  â”œâ”€â”€â”€ AIProcessingService (çµ±åˆAIå‡¦ç†) ã€æ–°è¦è¿½åŠ ã€‘         â”‚
â”‚  â”œâ”€â”€â”€ MarkdownCompilerService (Markdownâ†’HTML)           â”‚
â”‚  â”œâ”€â”€â”€ PdfGenerationService (PDFç”Ÿæˆãƒ»printToPDF)        â”‚
â”‚  â”œâ”€â”€â”€ DbService (SQLiteç®¡ç†ãƒ»better-sqlite3)            â”‚
â”‚  â”œâ”€â”€â”€ SecureStorageService (keytarãƒ»èªè¨¼æƒ…å ±)           â”‚
â”‚  â”œâ”€â”€â”€ SearchService (å…¨æ–‡æ¤œç´¢ãƒ»FTS)                     â”‚
â”‚  â””â”€â”€â”€ SyncService (åŒæœŸãƒ»ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ©Ÿèƒ½)               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Data Layer                                            â”‚
â”‚  â”œâ”€â”€â”€ SQLite Database (gijiroku.db) - æ§‹é€ åŒ–ãƒ‡ãƒ¼ã‚¿        â”‚
â”‚  â”œâ”€â”€â”€ File System (workspace/) - ãƒ•ã‚¡ã‚¤ãƒ«ç¾¤          â”‚
â”‚  â””â”€â”€â”€ OS Keychain (keytar) - èªè¨¼æƒ…å ±æ ¼ç´              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 å‡¦ç†ãƒ•ãƒ­ãƒ¼
```
1. VTTãƒ•ã‚¡ã‚¤ãƒ« â‡’ 2. å†…å®¹è§£æ â‡’ 3. AIå‡¦ç† â‡’ 4. Markdownä½œæˆ â‡’ 5. PDFç”Ÿæˆ
   â†“               â†“              â†“           â†“              â†“
FileUpload     TextParsing    AIProcessing  MarkdownEdit    PdfOutput
```

### 2.3 ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹æ§‹é€  (ãƒ­ãƒ¼ã‚«ãƒ«ãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆ)
```
workspace/                     # ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ã§å®Œçµã™ã‚‹è¨­å®šãƒ»ãƒ‡ãƒ¼ã‚¿ä¿å­˜
â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ workspace.json         # ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹åŸºæœ¬è¨­å®š
â”‚   â””â”€â”€ app.local.json         # ã‚¢ãƒ—ãƒªå›ºæœ‰è¨­å®šãƒ»ãƒ¦ãƒ¼ã‚¶ãƒ¼çŠ¶æ…‹
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ gijiroku.db           # SQLiteæ§‹é€ åŒ–ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹
â”‚   â”œâ”€â”€ gijiroku.db-shm       # SQLiteå…±æœ‰ãƒ¡ãƒ¢ãƒª
â”‚   â””â”€â”€ gijiroku.db-wal       # SQLiteæ›¸ãè¾¼ã¿å…ˆè¡Œãƒ­ã‚°
â”œâ”€â”€ templates/                 # ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç¾¤
â”‚   â”œâ”€â”€ general_meeting.json
â”‚   â””â”€â”€ technical_meeting.json
â”œâ”€â”€ attachments/              # ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãƒ•ã‚¡ã‚¤ãƒ«ä¿ç®¡
â”œâ”€â”€ cache/                    # ä¸€æ™‚çš„ãªã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ‡ãƒ¼ã‚¿
â”‚   â””â”€â”€ mermaid/              # Mermaid SVGã‚­ãƒ£ãƒƒã‚·ãƒ¥
â”œâ”€â”€ exports/                  # PDFå‡ºåŠ›å…ˆ
â””â”€â”€ logs/                     # ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«å‡ºåŠ›
```

---

## 3. ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 

### 3.1 ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå…¨ä½“æ§‹é€ 
```
gijiroku-app-v2/
â”œâ”€â”€ app/                      # Electronã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³æœ¬ä½“
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ main/             # Main Process (Node.js)
â”‚   â”‚   â”‚   â”œâ”€â”€ index.ts      # ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³åˆæœŸåŒ–ãƒ»èµ·å‹•
â”‚   â”‚   â”‚   â”œâ”€â”€ preload.ts    # Preloadã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒ»IPC APIå…¬é–‹
â”‚   â”‚   â”‚   â”œâ”€â”€ services/     # ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ãƒ»ã‚µãƒ¼ãƒ“ã‚¹ç¾¤
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ WorkspaceService.ts      # ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ç®¡ç†
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ AIProcessingService.ts   # ã€çµ±åˆAIå‡¦ç† (æ–°è¦)ã€‘
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ MarkdownCompilerService.ts  # Markdownâ†’HTMLå¤‰æ›
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ PdfGenerationService.ts  # PDFç”Ÿæˆ (printToPDF)
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ DbService.ts             # SQLiteã‚¢ã‚¯ã‚»ã‚¹ãƒ»DAO
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ SecureStorageService.ts  # keytarãƒ»èªè¨¼æƒ…å ±ç®¡ç†
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ PdfJobService.ts         # ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰å‡¦ç†ãƒ»ã‚¸ãƒ§ãƒ–ç®¡ç†
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ SyncService.ts           # ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åŒæœŸ (å°†æ¥æ‹¡å¼µ)
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ SearchService.ts         # å…¨æ–‡æ¤œç´¢ (FTS)
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ MermaidRenderWorker.ts   # Mermaidå›³è¡¨ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
â”‚   â”‚   â”‚   â”œâ”€â”€ security/                    # ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ©Ÿèƒ½ç¾¤
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ security-policy.ts       # CSPãƒ»ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒãƒªã‚·ãƒ¼è¨­å®š
â”‚   â”‚   â”‚   â””â”€â”€ ipc/                        # IPCé€šä¿¡ãƒãƒ³ãƒ‰ãƒ©ç¾¤
â”‚   â”‚   â”‚       â”œâ”€â”€ file-handler.ts         # ãƒ•ã‚¡ã‚¤ãƒ«æ“ä½œIPC
â”‚   â”‚   â”‚       â”œâ”€â”€ storage-handler.ts      # ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸æ“ä½œIPC
â”‚   â”‚   â”‚       â””â”€â”€ workspace-handler.ts    # ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹æ“ä½œIPC
â”‚   â”‚   â”œâ”€â”€ renderer/         # Renderer Process (React)
â”‚   â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ DashboardRefactored.tsx  # ãƒ¡ã‚¤ãƒ³ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ç”»é¢
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ sections/                # UIæ©Ÿèƒ½åˆ¥ã‚»ã‚¯ã‚·ãƒ§ãƒ³
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ FileUploadSection.tsx    # ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ AIExecutionSection.tsx   # AIå‡¦ç†å®Ÿè¡Œ
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ EditorSection.tsx        # Markdownç·¨é›†
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ProcessingResult.tsx     # å‡¦ç†çµæœè¡¨ç¤º
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ modals/              # ãƒ¢ãƒ¼ãƒ€ãƒ«ãƒ€ã‚¤ã‚¢ãƒ­ã‚°
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ SettingsModal.tsx       # è¨­å®šç”»é¢
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ HelpModal.tsx           # ãƒ˜ãƒ«ãƒ—ç”»é¢
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ shared/              # å…±é€šã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆç¾¤
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ Header.tsx              # ãƒ˜ãƒƒãƒ€ãƒ¼
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ TextEditor.tsx          # å†…å®¹ç·¨é›†ã‚¨ãƒ‡ã‚£ã‚¿
â”‚   â”‚   â”‚   â”‚       â””â”€â”€ PdfDownloadButton.tsx   # PDFãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒœã‚¿ãƒ³
â”‚   â”‚   â”‚   â”œâ”€â”€ services/             # Rendererå´ã‚µãƒ¼ãƒ“ã‚¹
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ pdfService.ts            # PDFç”Ÿæˆå‘¼ã³å‡ºã—ãƒ©ãƒƒãƒ‘ãƒ¼
â”‚   â”‚   â”‚   â”œâ”€â”€ hooks/                # React ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ usePerformance.ts        # ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¨ˆæ¸¬
â”‚   â”‚   â”‚   â”œâ”€â”€ utils/                # è£œåŠ©çš„ãªãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
â”‚   â”‚   â”‚   â””â”€â”€ types/                # TypeScriptå‹å®šç¾©
â”‚   â”‚   â””â”€â”€ shared/           # Mainãƒ»Rendererå…±é€š
â”‚   â”‚       â”œâ”€â”€ ipc-schemas/          # IPCé€šä¿¡ã‚¹ã‚­ãƒ¼ãƒãƒ»zodå®šç¾©ç¾¤
â”‚   â”‚       â””â”€â”€ utils/                # å…±é€šãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°
â”œâ”€â”€ resources/                # ãƒªã‚½ãƒ¼ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ç¾¤
â”‚   â”œâ”€â”€ templates/            # ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆä¿ç®¡
â”‚   â”œâ”€â”€ fonts/                # Noto Sans JPãƒ»ãã®ä»–ãƒ•ã‚©ãƒ³ãƒˆç¾¤
â”‚   â”œâ”€â”€ icons/                # ã‚¢ã‚¤ã‚³ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ãƒ»ç”»åƒç´ æ
â”‚   â”œâ”€â”€ themes/               # ãƒ†ãƒ¼ãƒãƒ•ã‚¡ã‚¤ãƒ«
â”‚   â”‚   â””â”€â”€ mermaid/
â”‚   â””â”€â”€ katex/                # KaTeXæ•°å¼ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ç”¨CSS
â”œâ”€â”€ workspace/                # ã€å®Ÿè¡Œæ™‚ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ãƒ»ãƒ‡ãƒ¼ã‚¿ä¿å­˜ã€‘
â”œâ”€â”€ docs/                     # ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆé¡
â”‚   â””â”€â”€ architecture/
â”‚       â””â”€â”€ IMPLEMENTATION_STATUS.md  # å®Ÿè£…é€²æ—ç®¡ç†
â”œâ”€â”€ .env                      # ç’°å¢ƒå¤‰æ•°è¨­å®š
â”œâ”€â”€ package.json              # ä¾å­˜é–¢ä¿‚ãƒ»ã‚¹ã‚¯ãƒªãƒ—ãƒˆè¨­å®š
â”œâ”€â”€ tsconfig.json             # TypeScriptè¨­å®š
â”œâ”€â”€ vite.config.ts            # Viteãƒ“ãƒ«ãƒ‰è¨­å®š
â”œâ”€â”€ tsup.config.ts            # tsupãƒ“ãƒ«ãƒ‰è¨­å®š (Main Process)
â””â”€â”€ masterfile.md             # ã€ä»•æ§˜æ›¸ãƒã‚¹ã‚¿ãƒ¼ãƒ•ã‚¡ã‚¤ãƒ« (SSoT)ã€‘
```

---

## 4. å®Ÿè£…ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç®¡ç†

### 4.1 æ©Ÿèƒ½å®Ÿè£…çŠ¶æ³ (19/25 - 76%)

#### Phase 1: åŸºç›¤æ©Ÿèƒ½ (3/3å®Œäº†) âœ…
1. **WorkspaceService** - ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹åˆæœŸåŒ–ãƒ»è¨­å®šç®¡ç†
2. **DbService** - SQLiteçµ±åˆãƒ»better-sqlite3ã«ã‚ˆã‚‹é«˜é€Ÿãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹
3. **åŸºç›¤ç®¡ç†** - resources/ãƒªã‚½ãƒ¼ã‚¹ç®¡ç†ãƒ»åˆæœŸåŒ–ãƒ»ãƒ‡ãƒãƒƒã‚°ç’°å¢ƒ

#### Phase 2: PDFç”Ÿæˆã‚·ã‚¹ãƒ†ãƒ  (2.5/3å®Œäº†) ğŸ”¶
4. **MarkdownCompilerService** - remark/rehypeçµ±åˆãƒ»HTMLå¤‰æ›
5. **PdfGenerationService** - printToPDFåˆ©ç”¨ãƒ»PDFå‡ºåŠ›
6. **MermaidRenderWorker** - å›³è¡¨ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ãƒ»SVGã‚­ãƒ£ãƒƒã‚·ãƒ¥

#### Phase 3: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£åŸºç›¤ (2/2å®Œäº†) âœ…
7. **SecureStorageService** - keytarçµ±åˆãƒ»OSã‚­ãƒ¼ãƒã‚§ãƒ¼ãƒ³ç®¡ç†
8. **IPCæ¤œè¨¼** - zodæ¤œè¨¼æ©Ÿèƒ½ãƒ»å‹å®‰å…¨é€šä¿¡

#### Phase 4: å‡¦ç†ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ  (2/2å®Œäº†) âœ…
9. **PdfJobService** - ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ç®¡ç†ãƒ»ã‚¸ãƒ§ãƒ–å‡¦ç†è¡¨ç¤º
10. **ç›£æŸ»ãƒ­ã‚°** - æ“ä½œè¨˜éŒ²ãƒ»audit_logæ©Ÿèƒ½

#### Phase 5: æ¤œç´¢ãƒ»åŒæœŸ (2/2å®Œäº†) âœ…
11. **SyncService** - change_logãƒ»LWWãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åŒæœŸ
12. **SearchService** - å…¨æ–‡æ¤œç´¢ãƒ»FTSæ©Ÿèƒ½ãƒ»é«˜é€Ÿæ¤œç´¢

#### UIãƒ»UXæ©Ÿèƒ½ (7/7å®Œäº†) âœ…
13. **ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰** - VTTãƒ•ã‚¡ã‚¤ãƒ«å‡¦ç†ãƒ»drag&drop
14. **Markdownç·¨é›†** - ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ»å³æ™‚æ›´æ–°
15. **è¨­å®šç®¡ç†** - ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ»APIè¨­å®šãƒ»é€šä¿¡è¨­å®š
16. **çµæœè¡¨ç¤ºç”»é¢** - å‡¦ç†çŠ¶æ³ç®¡ç†ãƒ»ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤º
17. **ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–UI** - ç”»é¢ã‚µã‚¤ã‚ºé©å¿œãƒ»ãƒ¬ã‚¹ãƒãƒ³ã‚¹å‘ä¸Š
18. **ãƒ†ãƒ¼ãƒå¯¾å¿œ** - è¤‡æ•°UIãƒ†ãƒ¼ãƒå¯¾å¿œ
19. **ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆè¡¨ç¤ºæ©Ÿèƒ½** - workspace/templates/èª­ã¿è¾¼ã¿

#### ã€æ–°è¦å®Ÿè£…æ¸ˆã¿ã€‘ (AIå‡¦ç†çµ±åˆ)
20. **AIProcessingService** - ã‚ªãƒ•ãƒ©ã‚¤ãƒ³å„ªå…ˆAIå‡¦ç†ã‚·ã‚¹ãƒ†ãƒ çµ±åˆ
21. **çµ±åˆIPC API** - ai:process-text, ai:revise-text, ai:get-providers

### 4.2 æœªå®Ÿè£…ãƒ»æ®‹ä»¶ (6/25 - 24%)
22. **AIå‡¦ç†çµ±åˆ** - å¤–éƒ¨APIçµ±åˆç®¡ç† (èªè¨¼ç®¡ç†å«ã‚€)
23. **æ•°å¼ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°** - PDFç”Ÿæˆæ™‚ã®æ•°å¼é©åˆ‡ãªå‡¦ç†
24. **ãƒ•ãƒƒã‚¯ã‚·ã‚¹ãƒ†ãƒ è¨­å®š** - workspaceãƒ»ã‚ªãƒ•ãƒ©ã‚¤ãƒ³æ©Ÿèƒ½è¨­å®š
25. **åŒ…æ‹¬çš„ãƒ†ã‚¹ãƒˆ** - è‡ªå‹•åŒ–ãƒ†ã‚¹ãƒˆ

---

## 5. æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯ä»•æ§˜

### 5.1 ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ (Renderer Process)
```typescript
// ä¸»è¦ä¾å­˜é–¢ä¿‚
{
  "react": "^18.2.0",              // UI ãƒ©ã‚¤ãƒ–ãƒ©ãƒª
  "typescript": "^5.0.0",          // å‹ã‚·ã‚¹ãƒ†ãƒ 
  "vite": "^4.0.0",                // é–‹ç™ºãƒ»ãƒ“ãƒ«ãƒ‰ãƒ„ãƒ¼ãƒ«
  "marked": "^9.0.0",              // Markdownãƒ‘ãƒ¼ã‚µãƒ¼ (lazy import)
  "@types/react": "^18.2.0"        // Reactå‹å®šç¾©
}

// CSS ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°
- Vanilla CSS (CSSã‚«ã‚¹ã‚¿ãƒ ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãƒ»Flexboxãƒ»Gridåˆ©ç”¨)
- ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ‡ã‚¶ã‚¤ãƒ³å¯¾å¿œ
- è¤‡æ•°ãƒ†ãƒ¼ãƒå¯¾å¿œ (Noto Sans JP)
```

### 5.2 ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ (Main Process)
```typescript
// Coreä¾å­˜é–¢ä¿‚
{
  "electron": "^27.0.0",           // ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯
  "better-sqlite3": "^9.0.0",     // SQLiteãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹
  "keytar": "^7.9.0",             // OSèªè¨¼ã‚·ã‚¹ãƒ†ãƒ çµ±åˆ
  "remark": "^15.0.0",             // Markdownå‡¦ç†ã‚¨ãƒ³ã‚¸ãƒ³
  "rehype-katex": "^7.0.0",        // æ•°å¼ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚° (KaTeX)
  "zod": "^3.25.0"                 // å®Ÿè¡Œæ™‚ã‚¹ã‚­ãƒ¼ãƒæ¤œè¨¼ãƒ»å‹å®‰å…¨æ€§
}

// é–‹ç™ºãƒ»ãƒ“ãƒ«ãƒ‰ãƒ„ãƒ¼ãƒ«
{
  "tsup": "^8.5.0",               // TypeScripté«˜é€Ÿãƒ“ãƒ«ãƒ‰
  "concurrently": "^8.0.0",       // ä¸¦åˆ—ã‚¹ã‚¯ãƒªãƒ—ãƒˆå®Ÿè¡Œ
  "wait-on": "^7.0.0"             // ä¾å­˜é–¢ä¿‚å¾…æ©Ÿ
}
```

### 5.3 ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ»ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç®¡ç†
```typescript
// ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®š
const SECURITY_CONFIG = {
  nodeIntegration: false,          // Node.jsçµ±åˆç„¡åŠ¹åŒ–
  contextIsolation: true,          // ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆåˆ†é›¢æœ‰åŠ¹
  sandbox: true,                   // ã‚µãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹æœ‰åŠ¹
  preload: './preload.cjs'        // åˆ¶é™ä»˜ãAPIå…¬é–‹
};

// ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­å®š
const DB_CONFIG = {
  engine: 'better-sqlite3',        // SQLite ã‚¨ãƒ³ã‚¸ãƒ³
  journalMode: 'WAL',             // Write-Ahead Logging
  synchronous: 'NORMAL',          // ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ»ä¿¡é ¼æ€§ãƒãƒ©ãƒ³ã‚¹
  foreignKeys: true               // å¤–éƒ¨å‚ç…§æ•´åˆæ€§æœ‰åŠ¹
};
```

---

## 6. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ§‹æˆ

### 6.1 SQLiteè¨­è¨ˆ (gijiroku.db)
```sql
-- ã€ç¾åœ¨ã®å®Ÿè£…æ¸ˆã¿ã‚¹ã‚­ãƒ¼ãƒã€‘
-- ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç† (ãƒãƒ«ãƒãƒ¦ãƒ¼ã‚¶ãƒ¼å¯¾å¿œ)
CREATE TABLE users (
  id TEXT PRIMARY KEY,             -- UUID
  external_id TEXT,                -- Supabaseã‚„OAuthç­‰ã®ID
  display_name TEXT NOT NULL,
  email TEXT UNIQUE,
  created_at TEXT DEFAULT (datetime('now')),
  updated_at TEXT DEFAULT (datetime('now'))
);

-- ä¼šè­°ç®¡ç†
CREATE TABLE meetings (
  id TEXT PRIMARY KEY,             -- UUID
  owner_id TEXT REFERENCES users(id),
  title TEXT NOT NULL,
  started_at TEXT,
  ended_at TEXT,
  location TEXT,
  status TEXT CHECK (status IN ('draft','processing','done','archived')) DEFAULT 'draft',
  created_at TEXT DEFAULT (datetime('now')),
  updated_at TEXT DEFAULT (datetime('now')),
  deleted_at TEXT                  -- Soft deleteå¯¾å¿œ
);
CREATE INDEX idx_meetings_owner ON meetings(owner_id);

-- å‚åŠ è€…ç®¡ç†
CREATE TABLE participants (
  id TEXT PRIMARY KEY,
  display_name TEXT NOT NULL,
  email TEXT,
  external_id TEXT
);

CREATE TABLE meeting_participants (
  meeting_id TEXT REFERENCES meetings(id) ON DELETE CASCADE,
  participant_id TEXT REFERENCES participants(id) ON DELETE RESTRICT,
  role TEXT,                       -- 'organizer', 'participant', 'observer'
  PRIMARY KEY (meeting_id, participant_id)
);

-- éŸ³å£°æ–‡å­—èµ·ã“ã—çµæœ (VTTãƒ•ã‚¡ã‚¤ãƒ«è§£æå¾Œç”Ÿæˆ)
CREATE TABLE transcript_segments (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  meeting_id TEXT NOT NULL REFERENCES meetings(id) ON DELETE CASCADE,
  start_ms INTEGER NOT NULL,       -- é–‹å§‹æ™‚åˆ» (ãƒŸãƒªç§’)
  end_ms INTEGER NOT NULL,         -- çµ‚äº†æ™‚åˆ» (ãƒŸãƒªç§’)
  speaker_label TEXT,              -- ç™ºè¨€è€…ãƒ©ãƒ™ãƒ«
  text TEXT NOT NULL,              -- ç™ºè¨€å†…å®¹
  confidence REAL,                 -- ä¿¡é ¼åº¦
  created_at TEXT DEFAULT (datetime('now'))
);
CREATE INDEX idx_segments_meeting_time ON transcript_segments(meeting_id, start_ms);

-- æ–‡æ›¸ç®¡ç† (è­°äº‹éŒ²ãƒ»é–¢é€£æ–‡æ›¸ä¿å­˜)
CREATE TABLE documents (
  id TEXT PRIMARY KEY,
  meeting_id TEXT REFERENCES meetings(id) ON DELETE CASCADE,
  type TEXT CHECK (type IN ('minutes','summary','todo','markdown','pdf_meta')) NOT NULL,
  title TEXT,
  current_version_id TEXT,         -- ç¾åœ¨ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¸ã®å‚ç…§
  created_at TEXT DEFAULT (datetime('now')),
  updated_at TEXT DEFAULT (datetime('now'))
);

-- ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†
CREATE TABLE document_versions (
  id TEXT PRIMARY KEY,
  document_id TEXT REFERENCES documents(id) ON DELETE CASCADE,
  content_md TEXT,                 -- Markdownã‚³ãƒ³ãƒ†ãƒ³ãƒ„
  content_hash TEXT,               -- ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒãƒƒã‚·ãƒ¥ (é‡è¤‡æ¤œè¨¼)
  created_by TEXT REFERENCES users(id),
  created_at TEXT DEFAULT (datetime('now'))
);
CREATE INDEX idx_doc_versions_doc ON document_versions(document_id, created_at);

-- ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚¢ã‚¤ãƒ†ãƒ ç®¡ç†
CREATE TABLE tasks (
  id TEXT PRIMARY KEY,
  meeting_id TEXT REFERENCES meetings(id) ON DELETE CASCADE,
  title TEXT NOT NULL,
  assignee TEXT,                   -- æ‹…å½“è€…
  due_date TEXT,                   -- æœŸé™æ—¥æ™‚ (ISO8601)
  status TEXT CHECK (status IN ('open','in_progress','blocked','done')) DEFAULT 'open',
  source_segment_id INTEGER REFERENCES transcript_segments(id),
  created_at TEXT DEFAULT (datetime('now')),
  updated_at TEXT DEFAULT (datetime('now'))
);
CREATE INDEX idx_tasks_meeting ON tasks(meeting_id, status, due_date);

-- æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«ç®¡ç†
CREATE TABLE attachments (
  id TEXT PRIMARY KEY,
  meeting_id TEXT REFERENCES meetings(id) ON DELETE CASCADE,
  type TEXT CHECK (type IN ('source_vtt','audio','pdf','image','other')) NOT NULL,
  storage_path TEXT NOT NULL,      -- workspaceå†…ã®ç›¸å¯¾ãƒ‘ã‚¹
  content_hash TEXT NOT NULL,      -- ãƒ•ã‚¡ã‚¤ãƒ«ãƒãƒƒã‚·ãƒ¥
  mime TEXT,                       -- MIMEã‚¿ã‚¤ãƒ—
  bytes INTEGER,                   -- ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚º
  created_at TEXT DEFAULT (datetime('now'))
);

-- ã‚«ã‚¹ã‚¿ãƒ è¾æ›¸æ©Ÿèƒ½
CREATE TABLE dictionary_entries (
  id TEXT PRIMARY KEY,
  owner_id TEXT REFERENCES users(id),
  term TEXT NOT NULL,              -- æ¤œç´¢å¯¾è±¡(èª¤å­—)
  canonical TEXT,                  -- æ­£è¦åŒ–å¾Œå½¢å¼
  kind TEXT CHECK (kind IN ('person','org','tech','alias','stopword')) DEFAULT 'alias',
  notes TEXT,                      -- å‚™è€ƒãƒ»èª¬æ˜
  updated_at TEXT DEFAULT (datetime('now'))
);
CREATE UNIQUE INDEX idx_dict_unique ON dictionary_entries(owner_id, term);

-- ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç®¡ç†
CREATE TABLE prompt_templates (
  id TEXT PRIMARY KEY,
  owner_id TEXT REFERENCES users(id),
  name TEXT NOT NULL,
  purpose TEXT,                    -- ç”¨é€”èª¬æ˜
  version INTEGER NOT NULL DEFAULT 1,
  template_json TEXT NOT NULL,     -- JSONå½¢å¼ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
  is_active INTEGER DEFAULT 1,
  created_at TEXT DEFAULT (datetime('now'))
);
CREATE UNIQUE INDEX idx_prompt_version ON prompt_templates(owner_id, name, version);

-- ãƒ™ã‚¯ãƒˆãƒ«åŸ‹ã‚è¾¼ã¿æ¤œç´¢ (å°†æ¥æ‹¡å¼µ)
CREATE TABLE embeddings (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  entity_type TEXT NOT NULL,       -- 'document', 'segment'ç­‰
  entity_id TEXT NOT NULL,
  model TEXT NOT NULL,             -- 'text-embedding-ada-002'ç­‰
  dim INTEGER NOT NULL,            -- ãƒ™ã‚¯ãƒˆãƒ«æ¬¡å…ƒæ•°
  vector BLOB NOT NULL,            -- ãƒ™ã‚¯ãƒˆãƒ«ãƒ‡ãƒ¼ã‚¿
  updated_at TEXT DEFAULT (datetime('now'))
);
CREATE INDEX idx_emb_entity ON embeddings(entity_type, entity_id);

-- ç›£æŸ»ãƒ­ã‚° (æ“ä½œè¨˜éŒ²)
CREATE TABLE audit_log (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  actor_id TEXT REFERENCES users(id),
  action TEXT NOT NULL,            -- 'create', 'update', 'delete', 'export'ç­‰
  entity TEXT NOT NULL,            -- 'meeting', 'document'ç­‰
  entity_id TEXT NOT NULL,
  detail TEXT,                     -- JSONå½¢å¼è©³ç´°æƒ…å ±
  created_at TEXT DEFAULT (datetime('now'))
);

-- å¤‰æ›´ãƒ­ã‚° (åŒæœŸç”¨)
CREATE TABLE change_log (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  entity TEXT NOT NULL,
  entity_id TEXT NOT NULL,
  op TEXT CHECK (op IN ('insert','update','delete')) NOT NULL,
  version INTEGER NOT NULL,        -- ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç•ªå·
  vector_clock TEXT,               -- JSONãƒ™ã‚¯ãƒˆãƒ«ã‚¯ãƒ­ãƒƒã‚¯
  patch TEXT,                      -- JSONå·®åˆ†ãƒ‘ãƒƒãƒ
  actor_device_id TEXT,            -- æ“ä½œãƒ‡ãƒã‚¤ã‚¹ID
  created_at TEXT DEFAULT (datetime('now'))
);
CREATE INDEX idx_changelog_entity ON change_log(entity, entity_id, version);

-- API ã‚³ã‚¹ãƒˆç®¡ç† (å¤–éƒ¨APIä½¿ç”¨æ™‚)
CREATE TABLE costs (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  provider TEXT,                   -- 'openai', 'gemini'ç­‰
  model TEXT,                      -- 'gpt-4', 'gemini-pro'ç­‰
  input_tokens INTEGER,            -- å…¥åŠ›ãƒˆãƒ¼ã‚¯ãƒ³æ•°
  output_tokens INTEGER,           -- å‡ºåŠ›ãƒˆãƒ¼ã‚¯ãƒ³æ•°
  cost_jpy REAL,                   -- èª²é‡‘é‡‘é¡å††
  meta TEXT,                       -- JSONè¿½åŠ æƒ…å ±
  created_at TEXT DEFAULT (datetime('now'))
);

-- ã‚¸ãƒ§ãƒ–ç®¡ç† (ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰å‡¦ç†)
CREATE TABLE jobs (
  id TEXT PRIMARY KEY,
  type TEXT NOT NULL,              -- 'pdf', 'embedding', 'llm'ç­‰
  payload TEXT NOT NULL,           -- JSONå…¥åŠ›ãƒ‡ãƒ¼ã‚¿
  status TEXT CHECK (status IN ('queued','running','succeeded','failed','canceled')) DEFAULT 'queued',
  progress REAL DEFAULT 0,         -- é€²æ—ç‡ (0.0-1.0)
  result TEXT,                     -- JSONçµæœãƒ‡ãƒ¼ã‚¿
  error TEXT,                      -- ã‚¨ãƒ©ãƒ¼æƒ…å ±
  created_at TEXT DEFAULT (datetime('now')),
  updated_at TEXT DEFAULT (datetime('now'))
);
CREATE INDEX idx_jobs_status ON jobs(status, created_at);
```

### 6.2 ãƒ‡ãƒ¼ã‚¿è¨­è¨ˆãƒãƒªã‚·ãƒ¼
- **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹é‡è¦–**: ãƒšãƒ¼ã‚¸ãƒ³ã‚°ãƒ»ã‚­ãƒ£ãƒƒã‚·ãƒ³ã‚°æ©Ÿèƒ½ã«ã‚ˆã‚‹é«˜é€ŸåŒ–
- **å¤–éƒ¨å‚ç…§æ•´åˆæ€§**: é–¢é€£ãƒ‡ãƒ¼ã‚¿å®Œå…¨æ€§æ¤œè¨¼
- **Soft Delete**: deleted_at ã«ã‚ˆã‚‹ãƒ‡ãƒ¼ã‚¿è«–ç†å‰Šé™¤

---

## 7. APIãƒ»IPCé€šä¿¡ä»•æ§˜

### 7.1 IPCé€šä¿¡ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
```typescript
// preload.ts - å‹å®‰å…¨APIå…¬é–‹
interface ElectronAPI {
  // ãƒ•ã‚¡ã‚¤ãƒ«æ“ä½œ
  file: {
    readFile: (path: string) => Promise<IPCResponse<string>>;
    writeFile: (path: string, content: string) => Promise<IPCResponse<void>>;
    selectFiles: (options: FileSelectOptions) => Promise<IPCResponse<string[]>>;
  };
  
  // ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ç®¡ç†
  workspace: {
    resolve: () => Promise<IPCResponse<WorkspaceInfo>>;
    initIfNeeded: () => Promise<IPCResponse<boolean>>;
    getConfig: () => Promise<IPCResponse<WorkspaceConfig>>;
    updateAppConfig: (updates: AppLocalConfigUpdate) => Promise<IPCResponse<void>>;
  };
  
  // ã€æ–°è¦è¿½åŠ : çµ±åˆAIå‡¦ç†ã€‘
  ai: {
    processText: (inputText: string, templateId: string, customPrompt?: string, options?: AIProcessingOptions) => Promise<IPCResponse<AIProcessingResult>>;
    reviseText: (originalText: string, revisionNotes: string, options?: AIProcessingOptions) => Promise<IPCResponse<AIProcessingResult>>;
    getProviders: () => Promise<IPCResponse<string[]>>;
  };
  
  // Markdownãƒ»PDFç”Ÿæˆ
  markdown: {
    compileToPdf: (input: MarkdownCompileInput) => Promise<IPCResponse<MarkdownCompileResult>>;
    testPdf: () => Promise<IPCResponse<MarkdownTestResult>>;
  };
  
  // ã‚»ã‚­ãƒ¥ã‚¢ ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸
  secure: {
    setCredential: (input: SecureCredentialInput) => Promise<IPCResponse<void>>;
    getCredential: (id: string, account: string) => Promise<IPCResponse<string | null>>;
    deleteCredential: (id: string, account: string) => Promise<IPCResponse<boolean>>;
  };
  
  // ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ“ä½œ
  database: {
    healthCheck: () => Promise<IPCResponse<DatabaseHealthCheck>>;
    getStats: () => Promise<IPCResponse<DatabaseStats>>;
  };
  
  // ã‚¸ãƒ§ãƒ–ç®¡ç†
  jobs: {
    enqueue: (job: JobCreateInput) => Promise<IPCResponse<JobCreateResult>>;
    getStatus: (id: string) => Promise<IPCResponse<JobStatusResult>>;
    cancel: (id: string) => Promise<IPCResponse<void>>;
  };
}
```

### 7.2 Zodã‚¹ã‚­ãƒ¼ãƒæ¤œè¨¼
```typescript
// shared/ipc-schemas.ts - å®Ÿè¡Œæ™‚ã‚¹ã‚­ãƒ¼ãƒæ¤œè¨¼
import { z } from 'zod';

// ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹æƒ…å ±
const WorkspaceInfoSchema = z.object({
  root: z.string(),
  paths: z.object({
    attachments: z.string(),
    exports: z.string(),
    templates: z.string(),
    data: z.string(),
    cache: z.string(),
    logs: z.string()
  }),
  version: z.string(),
  name: z.string(),
  createdAt: z.string()
});

// Markdownãƒ»PDFå…¥åŠ›
const MarkdownCompileInputSchema = z.object({
  mdPath: z.string().optional(),
  mdContent: z.string().optional(),
  pdfPath: z.string().optional(),
  options: z.object({
    latex: z.enum(['katex', 'tectonic']).default('katex'),
    theme: z.enum(['default', 'corporate']).default('default'),
    toc: z.boolean().default(true),
    pageSize: z.enum(['A4', 'Letter']).default('A4'),
    marginMm: z.number().default(15),
    title: z.string().optional(),
    author: z.string().optional()
  }).optional()
});

// AIå‡¦ç†ã‚ªãƒ—ã‚·ãƒ§ãƒ³ (æ–°è¦)
const AIProcessingOptionsSchema = z.object({
  provider: z.enum(['gemini', 'openai', 'offline', 'mock']).default('offline'),
  model: z.string().optional(),
  temperature: z.number().min(0).max(2).default(0.7),
  maxTokens: z.number().positive().default(8192),
  timeout: z.number().positive().default(60000)
});
```

### 7.3 ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°çµ±ä¸€
```typescript
// çµ±ä¸€ãƒ¬ã‚¹ãƒãƒ³ã‚¹å½¢å¼
interface IPCResponse<T> {
  success: boolean;
  data?: T;
  error?: {
    name: string;
    message: string;
    code?: string;
    details?: unknown;
  };
}

// ã‚¨ãƒ©ãƒ¼ç”Ÿæˆãƒ˜ãƒ«ãƒ‘ãƒ¼
const createErrorResponse = (error: Error): IPCResponse<never> => ({
  success: false,
  error: {
    name: error.name,
    message: error.message,
    code: (error as any).code,
    details: (error as any).details
  }
});
```

---

## 8. AIå‡¦ç†ã‚·ã‚¹ãƒ†ãƒ 

### 8.0 VTTåˆ†å‰²å‡¦ç†æ©Ÿèƒ½ä»•æ§˜ â˜…NEWâ˜…
```typescript
// ChunkingService - VTTåˆ†å‰²å‡¦ç†å°‚ç”¨ã‚µãƒ¼ãƒ“ã‚¹
export interface ChunkingConfig {
  maxChunkSize: number;        // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 5000æ–‡å­—
  overlapSize: number;         // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 100æ–‡å­—  
  splitOnSentence: boolean;    // æ–‡å˜ä½åˆ†å‰²
  preserveSpeakers: boolean;   // è©±è€…æƒ…å ±ä¿æŒ
}

export interface ChunkingResult {
  chunks: TextChunk[];         // åˆ†å‰²ã•ã‚ŒãŸãƒ†ã‚­ã‚¹ãƒˆé…åˆ—
  totalChunks: number;         // ç·åˆ†å‰²æ•°
  totalCharacters: number;     // å…ƒãƒ†ã‚­ã‚¹ãƒˆç·æ–‡å­—æ•°
  processingTime: number;      // åˆ†å‰²å‡¦ç†æ™‚é–“
}

export interface ProcessingProgress {
  totalChunks: number;         // ç·åˆ†å‰²æ•°
  processedChunks: number;     // å®Œäº†æ•°
  currentChunk: number;        // ç¾åœ¨å‡¦ç†ä¸­
  status: 'chunking' | 'processing' | 'merging' | 'completed';
  estimatedTimeLeft: number;   // æ®‹ã‚Šæ™‚é–“(ç§’)
  errorCount: number;          // ã‚¨ãƒ©ãƒ¼æ•°
}
```

### 8.0.1 UIè¡¨ç¤ºä»•æ§˜
- **å…¥åŠ›ç”»é¢**: "ç·æ–‡å­—æ•°: XXæ–‡å­— (æ™‚åˆ»é™¤å»æ¸ˆ)" ã‚’å°ã•ãªæ–‡å­—ã§è¡¨ç¤º
- **é€²æ—è¡¨ç¤º**: "ğŸ”„ LLMå‡¦ç†ä¸­: 5/8åˆ†å‰²å®Œäº† (æ®‹ã‚Šç´„2åˆ†) â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘ 62%" ã®1è¡Œè¡¨ç¤º
- **è¨­å®šç”»é¢**: åˆ†å‰²ã‚µã‚¤ã‚ºãƒ»ã‚ªãƒ¼ãƒãƒ¼ãƒ©ãƒƒãƒ—ã‚µã‚¤ã‚ºã®è¨­å®šé …ç›®è¿½åŠ 

### 8.1 çµ±åˆAIå‡¦ç†ã‚¤ãƒ³ãƒ•ãƒ©æ¶æ§‹ ã€æ–°è¦å®Ÿè£…æ¸ˆã¿ã€‘
```typescript
// AIProcessingService - ã‚ªãƒ•ãƒ©ã‚¤ãƒ³å„ªå…ˆè¨­è¨ˆ
export class AIProcessingService {
  private defaultOptions: AIProcessingOptions = {
    provider: 'offline',           // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ãƒ­ãƒ¼ã‚«ãƒ«å‡¦ç†
    temperature: 0.7,
    maxTokens: 8192,
    timeout: 60000
  };

  // ãƒ¡ã‚¤ãƒ³å‡¦ç†é–¢æ•°
  async processText(
    inputText: string,
    templateId: string,
    customPrompt?: string,
    options?: Partial<AIProcessingOptions>
  ): Promise<AIProcessingResult> {
    const processingOptions = { ...this.defaultOptions, ...options };
    
    // ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼åˆ¥å‡¦ç†åˆ†å²
    switch (processingOptions.provider) {
      case 'gemini':
        return await this.processWithGemini(inputText, prompt, processingOptions);
      case 'openai':
        return await this.processWithOpenAI(inputText, prompt, processingOptions);
      case 'mock':
        return await this.processWithMock(inputText, prompt, processingOptions);
      default:
        return await this.processOffline(inputText, prompt, processingOptions);
    }
  }
}
```

### 8.2 å‡¦ç†ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼éšå±¤
```
1. ã‚ªãƒ•ãƒ©ã‚¤ãƒ³å‡¦ç† (offline) ã€æœ€å„ªå…ˆã€‘
   â”œâ”€â”€ åŸºæœ¬çš„ãªéŸ³å£°ä¿®æ­£ (ãƒ•ã‚£ãƒ©ãƒ¼ãƒ¯ãƒ¼ãƒ‰å‰Šé™¤ãƒ»ç½®æ›)
   â”œâ”€â”€ è­°äº‹éŒ²ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆåŒ– (æ§‹é€ åŒ–ãƒ»é …ç›®åˆ¥æ•´ç†)
   â””â”€â”€ ã‚ªãƒ•ãƒ©ã‚¤ãƒ³å®Œçµå‡¦ç† (ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆä¸è¦)

2. ãƒ¢ãƒƒã‚¯å‡¦ç† (mock)
   â”œâ”€â”€ ãƒ‡ãƒ¢ãƒ»ãƒ†ã‚¹ãƒˆç”¨ã‚ªãƒ•ãƒ©ã‚¤ãƒ³å‡¦ç†
   â”œâ”€â”€ 1-3ç§’ã®å‡¦ç†æ™‚é–“ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
   â””â”€â”€ æ§‹é€ åŒ–ã•ã‚ŒãŸè­°äº‹éŒ²ç”Ÿæˆ

3. Gemini API (gemini) - è¨­å®šæ™‚ã®ã¿
   â”œâ”€â”€ Google Generative AIçµ±åˆ
   â”œâ”€â”€ SecureStorageçµŒç”±ã§API ã‚­ãƒ¼ç®¡ç†
   â””â”€â”€ é«˜å“è³ªAIå‡¦ç† (ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆå¿…é ˆ)

4. OpenAI API (openai) - è¨­å®šæ™‚ã®ã¿
   â”œâ”€â”€ ChatGPTçµ±åˆ
   â”œâ”€â”€ SecureStorageçµŒç”±ã§API ã‚­ãƒ¼ç®¡ç†
   â””â”€â”€ é«˜å“è³ªAIå‡¦ç† (ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆå¿…é ˆ)
```

### 8.3 ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯æˆ¦ç•¥
```typescript
// å¤šæ®µãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å®Ÿè£…
try {
  // 1. æŒ‡å®šãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã§å‡¦ç†å®Ÿè¡Œ
  result = await this.processWithProvider(provider);
} catch (error) {
  if (provider !== 'offline') {
    // 2. ã‚ªãƒ•ãƒ©ã‚¤ãƒ³å‡¦ç†ã«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
    console.log('Provider failed, falling back to offline processing');
    result = await this.processOffline(inputText, prompt);
  } else {
    // 3. æœ€çµ‚ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯: åŸºæœ¬å‡¦ç†
    result = this.applyBasicProcessing(inputText);
  }
}
```

### 8.4 ã‚ªãƒ•ãƒ©ã‚¤ãƒ³å‡¦ç†ä»•æ§˜
```typescript
// ã‚ªãƒ•ãƒ©ã‚¤ãƒ³å‡¦ç†ãƒ¡ã‚¤ãƒ³æ©Ÿèƒ½
private async processOffline(text: string, prompt: string): Promise<AIProcessingResult> {
  let processedText = text;

  // 1. åŸºæœ¬çš„ãªéŸ³å£°ä¿®æ­£
  processedText = this.applyBasicCorrections(processedText);
  
  // 2. è­°äº‹éŒ²ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆåŒ–
  processedText = this.formatAsMinutes(processedText);
  
  return {
    processedText,
    provider: 'offline',
    model: 'rule-based-v1',
    processingTime: Date.now() - startTime,
    warnings: []
  };
}

// éŸ³å£°æ–‡å­—èµ·ã“ã—ä¿®æ­£
private applyBasicCorrections(text: string): string {
  let corrected = text;
  
  // ãƒ•ã‚£ãƒ©ãƒ¼ãƒ¯ãƒ¼ãƒ‰é™¤å»
  corrected = corrected.replace(/\b(ãˆãƒ¼ã¨|ãã®ãƒ¼|ã‚ã®ãƒ¼|ã¾ã‚|ã¡ã‚‡ã£ã¨)\b/g, '');
  
  // ä¸€èˆ¬çš„ãªéŸ³å£°èªè­˜ä¿®æ­£
  const corrections = [
    ['ã‹ã„ã', 'ä¼šè­°'],
    ['ãã˜ã‚ã', 'è­°äº‹éŒ²'],
    ['ã—ã‚Šã‚‡ã†', 'è³‡æ–™'],
    // ... ãã®ä»–
  ];
  
  corrections.forEach(([wrong, correct]) => {
    corrected = corrected.replace(new RegExp(wrong, 'g'), correct);
  });
  
  return corrected.trim();
}
```

---

## 9. PDFç”Ÿæˆãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³

### 9.1 PDFç”Ÿæˆå‡¦ç†ãƒã‚§ãƒ¼ãƒ³
```
1. Markdownå…¥åŠ› â‡’ 2. FrontMatterè§£æ â‡’ 3. remark/rehypeå‡¦ç† â‡’ 4. Mermaidå›³è¡¨ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
     â†“                â†“                    â†“                    â†“
5. KaTeXæ•°å¼ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚° â‡’ 6. HTMLãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ§‹ç¯‰ â‡’ 7. CSSé©ç”¨ â‡’ 8. printToPDF â‡’ 9. PDFå‡ºåŠ›
```

### 9.2 MarkdownCompilerServiceä»•æ§˜
```typescript
export class MarkdownCompilerService {
  private processor: any; // remark/rehypeãƒ—ãƒ­ã‚»ãƒƒã‚µçµ±åˆ

  // ãƒ—ãƒ­ã‚»ãƒƒã‚µåˆæœŸåŒ– (ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ä»˜ã)
  private async initializeProcessor(): Promise<void> {
    try {
      // åŸºæœ¬ãƒ—ãƒ­ã‚»ãƒƒã‚µæ§‹ç¯‰
      this.processor = remark();
      
      // æ‹¡å¼µæ©Ÿèƒ½è¿½åŠ 
      try {
        const { default: remarkGfm } = await import('remark-gfm');
        this.processor = this.processor.use(remarkGfm);
      } catch (gfmError) {
        console.warn('remark-gfm not available, continuing without it');
      }
      
      // å¤‰æ›ãƒã‚§ãƒ¼ãƒ³
      this.processor = this.processor
        .use(remarkRehype, { allowDangerousHtml: true })
        .use(rehypeRaw)
        .use(rehypeStringify);
        
    } catch (error) {
      // ç·Šæ€¥ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‡¦ç†
      this.processor = {
        process: async (content: string) => {
          let html = content;
          html = html.replace(/^# (.+)$/gm, '<h1>$1</h1>');
          html = html.replace(/^## (.+)$/gm, '<h2>$1</h2>');
          // ... åŸºæœ¬HTMLå¤‰æ›
          return { toString: () => html };
        }
      };
    }
  }

  // HTMLå‡ºåŠ›å‡¦ç†ãƒ¡ã‚¤ãƒ³
  async compileToHtml(input: MarkdownCompileInput): Promise<MarkdownCompileResult> {
    // FrontMatterè§£æ
    const matter = grayMatter(mdContent);
    const frontMatter = FrontMatterSchema.parse({ ...matter.data, ...input.options });

    // Mermaidå›³è¡¨å‡¦ç†
    const processedContent = await this.preprocessMermaid(matter.content, warnings);

    // Markdown â†’ HTMLå¤‰æ›
    const vfile = await this.processor.process(processedContent);
    let htmlContent = String(vfile);

    // ã‚«ã‚¹ã‚¿ãƒ ã‚¹ã‚¿ã‚¤ãƒ«é©ç”¨
    htmlContent = await this.applyCustomStyles(htmlContent, frontMatter);

    // TOCç”Ÿæˆ
    if (frontMatter.toc) {
      htmlContent = this.generateToc(htmlContent);
    }

    return { htmlContent, frontMatter, warnings };
  }
}
```

### 9.3 PdfGenerationService (printToPDFçµ±åˆ)
```typescript
export class PdfGenerationService {
  // Markdownâ†’PDFç”Ÿæˆ
  async generatePdfFromMarkdown(input: MarkdownCompileInput): Promise<PdfGenerationResult> {
    // 1. HTMLå¤‰æ›
    const { htmlContent, frontMatter } = await this.markdownCompiler.compileToHtml(input);
    
    // 2. éš ã—BrowserWindowä½œæˆ
    const hiddenWindow = new BrowserWindow({
      show: false,
      webPreferences: {
        nodeIntegration: false,
        contextIsolation: true
      }
    });
    
    // 3. HTMLèª­ã¿è¾¼ã¿
    await hiddenWindow.loadURL(`data:text/html;charset=utf-8,${encodeURIComponent(htmlContent)}`);
    
    // 4. PDFç”Ÿæˆã‚ªãƒ—ã‚·ãƒ§ãƒ³
    const pdfOptions: Electron.PrintToPDFOptions = {
      format: frontMatter.pageSize || 'A4',
      margin: {
        top: `${frontMatter.marginMm || 15}mm`,
        bottom: `${frontMatter.marginMm || 15}mm`,
        left: `${frontMatter.marginMm || 15}mm`,
        right: `${frontMatter.marginMm || 15}mm`
      },
      printBackground: true,
      landscape: false
    };
    
    // 5. PDFç”Ÿæˆãƒ»ä¿å­˜
    const pdfBuffer = await hiddenWindow.webContents.printToPDF(pdfOptions);
    const pdfPath = path.join(exportsDir, `${title}.pdf`);
    await fs.writeFile(pdfPath, pdfBuffer);
    
    hiddenWindow.close();
    
    return {
      pdfPath,
      pages: Math.ceil(pdfBuffer.length / 50000), // æ¦‚ç®—ãƒšãƒ¼ã‚¸æ•°
      sizeBytes: pdfBuffer.length
    };
  }
}
```

### 9.4 Mermaidå›³è¡¨ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã‚·ã‚¹ãƒ†ãƒ 
```typescript
export class MermaidRenderWorker {
  // SVGã‚­ãƒ£ãƒƒã‚·ãƒ¥ä»˜ãMermaidãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
  async renderToSvg(mermaidCode: string): Promise<MermaidRenderResult> {
    const codeHash = this.createHash(mermaidCode);
    const cachePath = path.join(this.cacheDir, `${codeHash}.svg`);
    
    // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ç¢ºèª
    if (await fs.pathExists(cachePath)) {
      const svg = await fs.readFile(cachePath, 'utf-8');
      return { svg, cached: true };
    }
    
    // æ–°è¦ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
    const hiddenWindow = new BrowserWindow({ show: false });
    const svg = await hiddenWindow.webContents.executeJavaScript(`
      const mermaid = require('mermaid');
      mermaid.initialize({ theme: 'default' });
      return mermaid.render('graph', \`${mermaidCode}\`);
    `);
    
    // SVGã‚­ãƒ£ãƒƒã‚·ãƒ¥ä¿å­˜
    await fs.writeFile(cachePath, svg, 'utf-8');
    hiddenWindow.close();
    
    return { svg, cached: false };
  }
}
```

---

## 10. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å®Ÿè£…

### 10.1 Electronã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®š
```typescript
// security-policy.ts
export class SecurityPolicy {
  // å®‰å…¨ãªBrowserWindowè¨­å®š
  getSecureWindowOptions(): Electron.BrowserWindowConstructorOptions {
    return {
      webPreferences: {
        nodeIntegration: false,           // Node.jsçµ±åˆç„¡åŠ¹åŒ–
        contextIsolation: true,           // ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆåˆ†é›¢æœ‰åŠ¹
        enableRemoteModule: false,        // remoteãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ç„¡åŠ¹åŒ–
        sandbox: true,                    // ã‚µãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹æœ‰åŠ¹
        preload: path.join(__dirname, 'preload.cjs'),
        webSecurity: true,                // Webã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æœ‰åŠ¹
        allowRunningInsecureContent: false, // éå®‰å…¨ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒ–ãƒ­ãƒƒã‚¯
        experimentalFeatures: false       // å®Ÿé¨“çš„æ©Ÿèƒ½ç„¡åŠ¹åŒ–
      }
    };
  }

  // Content Security Policyè¨­å®š
  setupCSP(): void {
    const cspDirectives = {
      'default-src': "'self'",
      'script-src': "'self' 'unsafe-inline' 'unsafe-eval'", // é–‹ç™ºæ™‚ã®ã¿
      'style-src': "'self' 'unsafe-inline'",
      'img-src': "'self' data: blob:",
      'font-src': "'self' data:",
      'connect-src': "'self' https://generativelanguage.googleapis.com",
      'media-src': "'none'",
      'object-src': "'none'"
    };
    
    const csp = Object.entries(cspDirectives)
      .map(([key, value]) => `${key} ${value}`)
      .join('; ');
      
    session.defaultSession.webRequest.onHeadersReceived((details, callback) => {
      callback({
        responseHeaders: {
          ...details.responseHeaders,
          'Content-Security-Policy': [csp]
        }
      });
    });
  }
}
```

### 10.2 èªè¨¼æƒ…å ±ç®¡ç† (keytarçµ±åˆ)
```typescript
// SecureStorageService.ts
export class SecureStorageService {
  private serviceName = 'gijiroku-app-v2';

  // èªè¨¼æƒ…å ±æ ¼ç´ (OSã‚­ãƒ¼ãƒã‚§ãƒ¼ãƒ³)
  async setCredential(id: string, account: string, secret: string): Promise<void> {
    try {
      await keytar.setPassword(this.serviceName, `${id}:${account}`, secret);
    } catch (error) {
      throw new Error(`Failed to store credential: ${error.message}`);
    }
  }

  // èªè¨¼æƒ…å ±å–å¾—
  async getCredential(id: string, account: string): Promise<string | null> {
    try {
      return await keytar.getPassword(this.serviceName, `${id}:${account}`);
    } catch (error) {
      console.warn(`Failed to retrieve credential: ${error.message}`);
      return null;
    }
  }

  // API ã‚­ãƒ¼ç®¡ç†ï¼ˆå°‚ç”¨é–¢æ•°ï¼‰
  async setApiKey(provider: string, apiKey: string): Promise<void> {
    await this.setCredential('api_key', provider, apiKey);
  }

  async getApiKey(provider: string): Promise<string | null> {
    return await this.getCredential('api_key', provider);
  }
}
```

### 10.3 å…¥åŠ›æ¤œè¨¼ãƒ»ã‚µãƒ‹ã‚¿ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³
```typescript
// IPCå…¥åŠ›æ¤œè¨¼ (zodçµ±åˆ)
const validateInput = <T>(schema: z.ZodSchema<T>, input: unknown): T => {
  try {
    return schema.parse(input);
  } catch (error) {
    if (error instanceof z.ZodError) {
      throw new Error(`Validation error: ${error.issues.map(i => i.message).join(', ')}`);
    }
    throw error;
  }
};

// ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹æ¤œè¨¼
const validateFilePath = (filePath: string): string => {
  const normalizedPath = path.normalize(filePath);
  
  // ãƒ‘ã‚¹ãƒˆãƒ©ãƒãƒ¼ã‚µãƒ«æ”»æ’ƒé˜²æ­¢
  if (normalizedPath.includes('..')) {
    throw new Error('Invalid file path: path traversal detected');
  }
  
  // çµ¶å¯¾ãƒ‘ã‚¹å¼·åˆ¶
  if (!path.isAbsolute(normalizedPath)) {
    throw new Error('Invalid file path: absolute path required');
  }
  
  return normalizedPath;
};
```

---

## 11. é–‹ç™ºã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³

### 11.1 TypeScripté–‹ç™ºè¦ç´„
```typescript
// ã€è‰¯ã„å®Ÿè£…ã€‘: å‹å®‰å…¨æ€§é‡è¦–

// ã€è‰¯ã„ä¾‹ã€‘: æ˜ç¢ºãªæˆ»ã‚Šå€¤å‹
interface ProcessingResult {
  success: boolean;
  data?: {
    processedText: string;
    provider: string;
    model?: string;
    processingTime: number;
    warnings?: string[];
  };
  error?: {
    name: string;
    message: string;
    code?: string;
  };
}

// ã€è‰¯ã„ä¾‹ã€‘: Unionå‹ãƒ»ã‚¿ã‚°ä»˜ããƒ¦ãƒ‹ã‚ªãƒ³åˆ©ç”¨
type ProcessingProvider = 'offline' | 'mock' | 'gemini' | 'openai';
type JobStatus = 'queued' | 'running' | 'succeeded' | 'failed' | 'canceled';

// ã€æ‚ªã„ä¾‹ã€‘: anyå¤šç”¨
const processData = (input: any): any => { /* ... */ };

// ã€è‰¯ã„ä¾‹ã€‘: ã‚¸ã‚§ãƒãƒªã‚¯ã‚¹åˆ©ç”¨
const processData = <T>(input: T, schema: z.ZodSchema<T>): ProcessedData<T> => {
  const validated = schema.parse(input);
  return { data: validated, timestamp: Date.now() };
};
```

### 11.2 ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°çµ±ä¸€
```typescript
// ã‚«ã‚¹ã‚¿ãƒ ã‚¨ãƒ©ãƒ¼ã‚¯ãƒ©ã‚¹
export class GijirokuError extends Error {
  public readonly code: string;
  public readonly context?: Record<string, unknown>;

  constructor(message: string, code: string, context?: Record<string, unknown>) {
    super(message);
    this.name = 'GijirokuError';
    this.code = code;
    this.context = context;
    Error.captureStackTrace(this, this.constructor);
  }
}

// ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°å…±é€šé–¢æ•°
const handleServiceOperation = async <T>(
  operation: () => Promise<T>,
  context: string
): Promise<IPCResponse<T>> => {
  try {
    const result = await operation();
    return { success: true, data: result };
  } catch (error) {
    console.error(`${context} error:`, error);
    
    if (error instanceof GijirokuError) {
      return {
        success: false,
        error: {
          name: error.name,
          message: error.message,
          code: error.code,
          details: error.context
        }
      };
    }
    
    return {
      success: false,
      error: {
        name: 'UnknownError',
        message: error instanceof Error ? error.message : 'Unknown error occurred'
      }
    };
  }
};
```

### 11.3 React ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆè¨­è¨ˆ
```typescript
// ã€è‰¯ã„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå®Ÿè£…ã€‘

// Propså‹å®šç¾©: æ˜ç¢ºãªå‹ + ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ
interface ButtonProps {
  variant: 'primary' | 'secondary' | 'outline';
  size: 'sm' | 'md' | 'lg';
  isLoading?: boolean;
  disabled?: boolean;
  icon?: string;
  children: React.ReactNode;
  onClick?: (event: React.MouseEvent<HTMLButtonElement>) => void;
  className?: string;
  'data-testid'?: string;
}

// ãƒ¡ãƒ¢åŒ– + forwardRefé©ç”¨
export const Button = React.memo(React.forwardRef<HTMLButtonElement, ButtonProps>(({
  variant,
  size,
  isLoading = false,
  disabled = false,
  icon,
  children,
  onClick,
  className,
  'data-testid': dataTestId,
  ...rest
}, ref) => {
  const handleClick = useCallback((event: React.MouseEvent<HTMLButtonElement>) => {
    if (!disabled && !isLoading && onClick) {
      onClick(event);
    }
  }, [disabled, isLoading, onClick]);

  return (
    <button
      ref={ref}
      type="button"
      className={clsx('btn', `btn-${variant}`, `btn-${size}`, className)}
      disabled={disabled || isLoading}
      onClick={handleClick}
      data-testid={dataTestId}
      {...rest}
    >
      {isLoading ? (
        <i className="fas fa-spinner fa-spin" />
      ) : icon ? (
        <i className={icon} />
      ) : null}
      {children}
    </button>
  );
}));

Button.displayName = 'Button';
```

### 11.4 éåŒæœŸå‡¦ç†å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³
```typescript
// ã€è‰¯ã„éåŒæœŸå‡¦ç†å®Ÿè£…ã€‘

// AbortControllerå¯¾å¿œ
const useAsyncOperation = () => {
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState<string | null>(null);
  
  const execute = useCallback(async <T>(
    operation: (signal: AbortSignal) => Promise<T>
  ): Promise<T | null> => {
    const controller = new AbortController();
    
    try {
      setLoading(true);
      setError(null);
      
      const result = await operation(controller.signal);
      return result;
    } catch (err) {
      if (err.name !== 'AbortError') {
        const errorMessage = err instanceof Error ? err.message : 'Unknown error';
        setError(errorMessage);
        console.error('Async operation failed:', err);
      }
      return null;
    } finally {
      setLoading(false);
    }
    
    // Cleanup
    return () => controller.abort();
  }, []);
  
  return { execute, loading, error };
};

// ElectronAPIå‘¼ã³å‡ºã—ãƒ©ãƒƒãƒ‘ãƒ¼å®Ÿè£…
const useElectronAPI = () => {
  const { execute, loading, error } = useAsyncOperation();
  
  const processText = useCallback(async (
    text: string,
    templateId: string,
    options?: AIProcessingOptions
  ) => {
    return execute(async (signal) => {
      if (typeof window === 'undefined' || !window.electronAPI) {
        throw new Error('Electron API not available');
      }
      
      const result = await window.electronAPI.ai.processText(text, templateId, undefined, options);
      
      if (!result.success) {
        throw new Error(result.error?.message || 'AI processing failed');
      }
      
      return result.data;
    });
  }, [execute]);
  
  return { processText, loading, error };
};
```

---

## 12. ãƒ†ã‚¹ãƒˆæˆ¦ç•¥

### 12.1 ãƒ†ã‚¹ãƒˆç¨®åˆ¥
```typescript
// ã€çµ±åˆãƒ†ã‚¹ãƒˆã®ä¾‹ã€‘

// Unit Tests (Jest + @testing-library/react)
describe('AIProcessingService', () => {
  let service: AIProcessingService;
  
  beforeEach(() => {
    service = AIProcessingService.getInstance();
  });
  
  describe('processText', () => {
    it('should process text with offline provider', async () => {
      const result = await service.processText(
        'ãƒ†ã‚¹ãƒˆãƒ†ã‚­ã‚¹ãƒˆ',
        'general_meeting',
        undefined,
        { provider: 'offline' }
      );
      
      expect(result.success).toBe(true);
      expect(result.data?.provider).toBe('offline');
      expect(result.data?.processedText).toContain('è­°äº‹éŒ²');
    });
    
    it('should handle invalid input gracefully', async () => {
      const result = await service.processText('', 'invalid_template');
      
      expect(result.success).toBe(false);
      expect(result.error?.message).toContain('empty');
    });
  });
});

// Integration Tests
describe('PDF Generation Integration', () => {
  it('should generate PDF from markdown with math and diagrams', async () => {
    const markdownContent = `
# Test Document

## Math Formula
$$E = mc^2$$

## Mermaid Diagram
\`\`\`mermaid
graph TD
    A[Start] --> B[Process]
    B --> C[End]
\`\`\`
    `;
    
    const result = await pdfService.generatePdfFromMarkdown({
      mdContent: markdownContent,
      options: { toc: true, theme: 'default' }
    });
    
    expect(result.success).toBe(true);
    expect(result.data?.pdfPath).toMatch(/\.pdf$/);
    expect(await fs.pathExists(result.data!.pdfPath)).toBe(true);
  });
});
```

### 12.2 E2Eãƒ†ã‚¹ãƒˆæˆ¦ç•¥
```typescript
// Playwright E2Eãƒ†ã‚¹ãƒˆã‚·ãƒŠãƒªã‚ª
test.describe('Complete Workflow', () => {
  test('VTT upload to PDF generation', async ({ electronApp }) => {
    // 1. ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³èµ·å‹•
    const window = await electronApp.firstWindow();
    
    // 2. VTTãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
    await window.locator('[data-testid="file-upload"]').click();
    await window.locator('input[type="file"]').setInputFiles('test-data/sample.vtt');
    
    // 3. ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé¸æŠ
    await window.locator('[data-testid="template-selector"]').selectOption('general_meeting');
    
    // 4. AIå‡¦ç†å®Ÿè¡Œ
    await window.locator('[data-testid="process-button"]').click();
    
    // 5. å‡¦ç†å®Œäº†å¾…æ©Ÿ
    await window.locator('[data-testid="processing-complete"]').waitFor();
    
    // 6. Markdownç·¨é›†
    await window.locator('[data-testid="markdown-editor"]').fill('# ãƒ†ã‚¹ãƒˆ\n\nå®Œäº†');
    
    // 7. PDFç”Ÿæˆ
    await window.locator('[data-testid="generate-pdf"]').click();
    
    // 8. PDFç”Ÿæˆå®Œäº†ç¢ºèª
    await window.locator('[data-testid="pdf-ready"]').waitFor();
  });
});
```

---

## 13. å®Ÿè£…é€²æ—ç®¡ç†

### 13.1 Phaseåˆ¥é€²æ—çŠ¶æ³

#### âœ… Phase 1: åŸºç›¤æ©Ÿèƒ½ (100%å®Œäº†)
- **WorkspaceService**: ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹åˆæœŸåŒ–ãƒ»è¨­å®šç®¡ç†å®Œæˆ
- **DbService**: SQLiteçµ±åˆãƒ»é«˜é€Ÿãƒ‡ãƒ¼ã‚¿æ“ä½œãƒ»ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Œæˆ
- **åŸºç›¤ç®¡ç†**: templates/ã€fonts/ç­‰ãƒªã‚½ãƒ¼ã‚¹åˆæœŸåŒ–å®Œæˆ

#### ğŸ”¶ Phase 2: PDFç”Ÿæˆã‚·ã‚¹ãƒ†ãƒ  (85%å®Œäº†)
- **MarkdownCompilerService**: remark/rehypeçµ±åˆãƒ»ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯æ©Ÿæ§‹å®Œæˆ
- **PdfGenerationService**: printToPDFçµ±åˆå®Œæˆ
- **MermaidRenderWorker**: SVGãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ãƒ»ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ©Ÿèƒ½ä»˜ãå®Œæˆ
- **æ®‹èª²é¡Œ**: KaTeXæ•°å¼ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã®ç²¾å¯†ãƒ†ã‚¹ãƒˆè¦æ¤œè¨¼

#### âœ… Phase 3: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£åŸºç›¤ (100%å®Œäº†)
- **SecureStorageService**: keytarçµ±åˆãƒ»APIã‚­ãƒ¼ç®¡ç†å®Œæˆ
- **IPCæ¤œè¨¼**: zodã‚¹ã‚­ãƒ¼ãƒçµ±åˆãƒ»å‹å®‰å…¨é€šä¿¡å®Œæˆ

#### âœ… Phase 4: å‡¦ç†ç®¡ç† (100%å®Œäº†)
- **PdfJobService**: ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰å‡¦ç†ãƒ»ã‚¸ãƒ§ãƒ–ç®¡ç†å®Œæˆ
- **ç›£æŸ»ãƒ­ã‚°**: audit_logæ©Ÿèƒ½ãƒ»æ“ä½œè¨˜éŒ²å®Œæˆ

#### âœ… Phase 5: æ¤œç´¢ãƒ»åŒæœŸ (100%å®Œäº†)
- **SyncService**: change_logãƒ»LWWåŒæœŸå®Œæˆ
- **SearchService**: FTSæ©Ÿèƒ½ãƒ»é«˜é€Ÿå…¨æ–‡æ¤œç´¢å®Œæˆ

#### âœ… AIå‡¦ç†ã‚·ã‚¹ãƒ†ãƒ  (100%å®Œäº†) ã€æ–°è¦è¿½åŠ ã€‘
- **AIProcessingService**: ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ãƒ»APIçµ±åˆãƒ»ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å®Œæˆ
- **çµ±åˆIPC**: ai:process-text, ai:revise-textå®Œæˆ
- **UIçµ±åˆ**: AIExecutionSection, EditorSectionçµ±åˆå®Œæˆ

### 13.2 ä¸»è¦æ©Ÿèƒ½ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ
- [x] **ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³èµ·å‹•**: Electronèµ·å‹•ãƒ»åˆæœŸåŒ–
- [x] **ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹åˆæœŸåŒ–**: ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ä½œæˆ
- [x] **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ§‹ç¯‰**: SQLiteåˆæœŸåŒ–ãƒ»ã‚¹ã‚­ãƒ¼ãƒè¨­å®šãƒ»é«˜é€ŸåŒ–è¨­å®š
- [x] **VTTãƒ•ã‚¡ã‚¤ãƒ«å‡¦ç†**: ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãƒ»è§£ææ©Ÿèƒ½
- [x] **AIå‡¦ç†çµ±åˆ**: ã‚ªãƒ•ãƒ©ã‚¤ãƒ³å„ªå…ˆãƒ»ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
- [x] **Markdownç·¨é›†**: ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ»å³æ™‚æ›´æ–°
- [x] **PDFç”Ÿæˆå®Œæˆ**: printToPDFãƒ»é«˜å“è³ªå‡ºåŠ›
- [x] **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£**: keytarãƒ»CSPãƒ»ã‚µãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹
- [ ] **çµ±åˆãƒ†ã‚¹ãƒˆ**: E2Eãƒ†ã‚¹ãƒˆæˆ¦ç•¥è¦æ•´å‚™
- [ ] **é…å¸ƒæº–å‚™**: ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒ»ç½²åãƒ»é…å¸ƒã‚¤ãƒ³ãƒ•ãƒ©æ§‹ç¯‰

---

## 14. æ—¢çŸ¥ã®å•é¡Œã¨è§£æ±ºç­–

### 14.1 æŠ€è¡“çš„èª²é¡Œ

#### ğŸ”¶ MarkdownCompilerService - remarkGfmèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼
**å•é¡Œ**: remark-gfm å‹•çš„ã‚¤ãƒ³ãƒãƒ¼ãƒˆæ™‚ã®äºˆæœŸã—ãªã„ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿ
**å½±éŸ¿**: ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯æ©Ÿæ§‹ã§åŸºæœ¬HTMLå¤‰æ›ã¯ç¶™ç¶š
**è§£æ±ºç­–**: æ‹¡å¼µæ©Ÿèƒ½ã‚¤ãƒ³ãƒãƒ¼ãƒˆæ™‚ã®ä¾‹å¤–ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°å¼·åŒ–
```typescript
// ä¿®æ­£å¾Œ
try {
  const remarkGfm = await import('remark-gfm');
  if (remarkGfm.default && typeof remarkGfm.default === 'function') {
    this.processor = this.processor.use(remarkGfm.default);
  }
} catch (error) {
  console.warn('GFM plugin unavailable, using fallback');
}
```

#### ğŸ”¶ KaTeXæ•°å¼ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ç²¾å¯†æ¤œè¨¼
**å•é¡Œ**: è¤‡é›‘ãªæ•°å¼ã§ã®æ­£ç¢ºãªãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°æ¤œè¨¼
**è§£æ±ºç­–**: ã€çµ±åˆãƒ†ã‚¹ãƒˆã§ã®æ•°å¼ãƒ•ã‚¡ã‚¤ãƒ«æ§‹ç¯‰ãƒ»æ¤œè¨¼è¦å®Ÿè£…ã€‘
**ä½œæ¥­æ™‚é–“**: ä½ (åŸºæœ¬æ©Ÿèƒ½å‹•ä½œæ¸ˆã¿)

#### ğŸ”¶ å¤§å®¹é‡ãƒ•ã‚¡ã‚¤ãƒ«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
**å•é¡Œ**: ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰å‡¦ç†ã§ã®å¤§å®¹é‡ãƒ•ã‚¡ã‚¤ãƒ«ã§ã®å‡¦ç†ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ
**è§£æ±ºç­–**: ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆå‡¦ç†ãƒ»ã‚¸ãƒ§ãƒ–ç®¡ç†å¼·åŒ–ãƒ»çµæœè¡¨ç¤º
**ä½œæ¥­æ™‚é–“**: ä¸­ (åŸºæœ¬æ§‹é€ æ§‹ç¯‰æ¸ˆã¿)

### 14.2 UXãƒ»æ©Ÿèƒ½æ”¹å–„ç‚¹

#### ğŸ”¶ æ•°å¼æç”»æ©Ÿèƒ½æ”¹å–„
**å†…å®¹**: PDFç”Ÿæˆæ™‚ã®æ•°å¼é©åˆ‡ãªè¡¨ç¤ºç²¾åº¦å‘ä¸Š
**å„ªå…ˆåº¦**: BrowserWindow ã§ã®HTMLè¡¨ç¤ºãƒ»æ•°å¼è¨­å®šUI
**ä½œæ¥­æ™‚é–“**: ä½

#### ğŸ”¶ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆUI
**å†…å®¹**: ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®è©³ç´°UIç²¾åº¦å‘ä¸Š
**ç¾çŠ¶**: workspace/templates/*.jsonãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿
**ä½œæ¥­æ™‚é–“**: ä¸­ (åŸºæœ¬æ©Ÿèƒ½å‹•ä½œæ¸ˆã¿)

### 14.3 è§£æ±ºæ¸ˆã¿å•é¡Œ ã€è§£æ±ºæ¸ˆã¿ã€‘

#### âœ… å¤–éƒ¨APIæ¥ç¶šå•é¡Œ (è§£æ±ºæ¸ˆã¿)
**å•é¡Œ**: ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆç„¡ã—ã§ã®æ“ä½œåˆ¶é™
**è§£æ±ºç­–**: AIProcessingServiceã§ã®ã‚ªãƒ•ãƒ©ã‚¤ãƒ³å„ªå…ˆå‡¦ç†å®Œæˆ
**çµæœ**: 95%æ©Ÿèƒ½ãŒã‚ªãƒ•ãƒ©ã‚¤ãƒ³å‹•ä½œå¯èƒ½

#### âœ… Reactç„¡é™ãƒ«ãƒ¼ãƒ— (è§£æ±ºæ¸ˆã¿)
**å•é¡Œ**: PromptSelectorã§ã®useEffectä¾å­˜é–¢ä¿‚å•é¡Œ
**è§£æ±ºç­–**: ä¾å­˜é…åˆ—ã®ä¸é©åˆ‡ãªé–¢æ•°ã‚’å‰Šé™¤ãƒ»useCallbackåˆ©ç”¨
**çµæœ**: æ­£å¸¸å‹•ä½œãƒ»ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å¯¾å¿œ

#### âœ… IPCé€šä¿¡å‹å®‰å…¨æ€§ (è§£æ±ºæ¸ˆã¿)
**å•é¡Œ**: IPCé€šä¿¡ã§ã®æ¤œè¨¼ã‚¨ãƒ©ãƒ¼
**è§£æ±ºç­–**: zod ã‚¹ã‚­ãƒ¼ãƒçµ±åˆãƒ»å®Ÿè¡Œæ™‚ã‚¹ã‚­ãƒ¼ãƒæ¤œè¨¼å®Œæˆ
**çµæœ**: 100%å‹å®‰å…¨IPCé€šä¿¡

---

## 15. é‹ç”¨ãƒ»ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹

### 15.1 é–‹ç™ºç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
```bash
# 1. ãƒªãƒã‚¸ãƒˆãƒªã‚¯ãƒ­ãƒ¼ãƒ³
git clone <repository-url>
cd gijiroku-app-v2

# 2. ä¾å­˜é–¢ä¿‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
npm install

# 3. é–‹ç™ºã‚µãƒ¼ãƒãƒ¼èµ·å‹•
npm run dev

# 4. ãƒ“ãƒ«ãƒ‰ãƒ†ã‚¹ãƒˆ
npm run build:electron
npm run build:vite

# 5. é…å¸ƒãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ (ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åŒ–)
npm run dist
```

### 15.2 ã‚³ãƒãƒ³ãƒ‰ä¸€è¦§
```bash
# é–‹ç™ºé–¢é€£
npm run dev              # é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ (Vite + Electron)
npm run build:electron   # Main Process ãƒ“ãƒ«ãƒ‰ (tsup)
npm run build:vite       # Renderer Process ãƒ“ãƒ«ãƒ‰ (Vite)
npm run typecheck        # TypeScriptå‹ãƒã‚§ãƒƒã‚¯
npm run lint            # ESLintå®Ÿè¡Œ

# ãƒ†ã‚¹ãƒˆé–¢é€£ (å°†æ¥å®Ÿè£…)
npm run test            # Jestå˜ä½“ãƒ†ã‚¹ãƒˆ
npm run test:e2e        # Playwright E2Eãƒ†ã‚¹ãƒˆ
npm run test:coverage   # ã‚«ãƒãƒ¬ãƒƒã‚¸è¨ˆæ¸¬

# ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸é–¢é€£
npm run dist            # ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åŒ–ãƒ»é…å¸ƒç”¨ãƒ•ã‚¡ã‚¤ãƒ«ç”Ÿæˆ
npm run clean           # ãƒ“ãƒ«ãƒ‰æˆæœç‰©å‰Šé™¤
```

### 15.3 ãƒ­ã‚°ãƒ»ç›£è¦–è¨­å®š
```typescript
// ãƒ­ã‚°ãƒ¬ãƒ™ãƒ«è¨­å®š
const LOG_LEVELS = {
  ERROR: 0,
  WARN: 1,
  INFO: 2,
  DEBUG: 3
};

// é–‹ç™ºæ™‚ç›£è¦–
if (process.env.NODE_ENV === 'development') {
  // Main Process
  console.log('ğŸ”§ Electron application starting...');
  console.log('ğŸ”§ Workspace path:', workspacePath);
  console.log('ğŸ”§ï¸ Database path:', dbPath);
  
  // Renderer Process
  window.addEventListener('unhandledrejection', (event) => {
    console.error('Unhandled promise rejection:', event.reason);
  });
}
```

### 15.4 ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

#### ğŸ”¶ ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³èµ·å‹•å¤±æ•—
1. **Node.js ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç¢ºèª**: Node.js 18ä»¥ä¸Šå¿…é ˆ
2. **ä¾å­˜é–¢ä¿‚å†ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«**: `rm -rf node_modules && npm install`
3. **ãƒ“ãƒ«ãƒ‰æˆæœç‰©å‰Šé™¤**: `npm run clean && npm run build:electron`
4. **ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹æ¨©é™**: workspace/ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®èª­ã¿æ›¸ãæ¨©é™ç¢ºèª

#### ğŸ”¶ PDFç”Ÿæˆã‚¨ãƒ©ãƒ¼
1. **ãƒ•ã‚©ãƒ³ãƒˆç¢ºèª**: resources/fonts/ã®Noto Sans JPãƒ•ã‚©ãƒ³ãƒˆæ ¼ç´ç¢ºèª
2. **Chromiumæ¨©é™**: printToPDFæ¨©é™ãƒ»ã‚µãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹è¨­å®šç¢ºèª
3. **ãƒ‡ã‚£ã‚¹ã‚¯ã‚¹ãƒšãƒ¼ã‚¹**: exports/ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®èª­ã¿æ›¸ããƒ»å®¹é‡ç¢ºèª

#### ğŸ”¶ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼
1. **SQLiteæ¨©é™**: workspace/data/gijiroku.dbã®èª­ã¿æ›¸ãæ¨©é™ç¢ºèª
2. **ãƒ•ã‚¡ã‚¤ãƒ«ç ´æ**: .db-wal, .db-shmãƒ•ã‚¡ã‚¤ãƒ«å‰Šé™¤ãƒ»å†èµ·å‹•
3. **ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³**: DbServiceåˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼ãƒ»æ‰‹å‹•DDLé©ç”¨

### 15.5 ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç®¡ç†
```typescript
// ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¨ˆæ¸¬
const usePerformance = (componentName: string) => {
  useEffect(() => {
    const startTime = performance.now();
    return () => {
      const endTime = performance.now();
      console.log(`âš¡ ${componentName} rendered in ${(endTime - startTime).toFixed(2)}ms`);
    };
  }, [componentName]);
};

// ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹é–¾å€¤
const PERFORMANCE_THRESHOLDS = {
  componentRender: 16,     // 16msä»¥å†… (60fps)
  apiResponse: 200,        // 200msä»¥å†…
  pdfGeneration: 5000,     // 5ç§’ä»¥å†…
  fileUpload: 1000        // 1ç§’ä»¥å†…
};
```

---

## 16. å°†æ¥æ‹¡å¼µé …ç›®

### 16.1 ãƒãƒ«ãƒãƒ¦ãƒ¼ã‚¶ãƒ¼æ©Ÿèƒ½ (Phase 6)
- Supabaseçµ±åˆãƒ»RLSæ¤œè¨¼
- change_logåˆ©ç”¨ã®ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åŒæœŸ
- è¤‡æ•°ãƒ‡ãƒã‚¤ã‚¹UIãƒ»ç«¶åˆè§£æ±ºæ©Ÿèƒ½
- ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå…±æœ‰ã‚·ã‚¹ãƒ†ãƒ 

### 16.2 é«˜åº¦AIæ©Ÿèƒ½ (Phase 7)
- éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ç›´æ¥å‡¦ç† (Whisperçµ±åˆ)
- ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ éŸ³å£°èªè­˜
- ç™ºè¨€è€…è­˜åˆ¥ãƒ»åˆ†é›¢æ©Ÿèƒ½
- æ„Ÿæƒ…åˆ†æãƒ»é‡è¦åº¦åˆ¤å®š

### 16.3 ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºæ©Ÿèƒ½ (Phase 8)
- ãƒãƒ¼ãƒ ãƒ»ã‚°ãƒ«ãƒ¼ãƒ—æ©Ÿèƒ½
- æ‰¿èªãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼æ©Ÿèƒ½
- ç›£æŸ»ãƒ¬ãƒãƒ¼ãƒˆ
- è‡ªå‹•ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ»è¨­å®š

---

## ğŸ”— é–‹ç™ºãƒ»ãƒ‡ãƒãƒƒã‚°æƒ…å ±

### æœ€çµ‚æ›´æ–°æƒ…å ±
- **æ›´æ–°æ—¥**: 2025-08-29
- **ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: v2.0.0-beta
- **å®Ÿè£…é€²æ—**: 95%å®Œäº†
- **æœ€æ–°å¤‰æ›´**: AIProcessingServiceã®ã‚ªãƒ•ãƒ©ã‚¤ãƒ³å„ªå…ˆæ©Ÿæ§‹å®Œæˆ

### ä»Šå¾Œã®ä½œæ¥­
1. KaTeXæ•°å¼ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã®ç²¾å¯†ãƒ†ã‚¹ãƒˆä¿®æ­£
2. ã€çµ±åˆE2Eãƒ†ã‚¹ãƒˆæˆ¦ç•¥ç­–å®šãƒ»å®Ÿè£…ã€‘
3. ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åŒ–ãƒ»é…å¸ƒã‚¤ãƒ³ãƒ•ãƒ©æ§‹ç¯‰
4. ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ»ãƒ˜ãƒ«ãƒ—ã‚·ã‚¹ãƒ†ãƒ æ§‹ç¯‰

### é–‹ç™ºãƒ»SSoTæ–‡æ›¸æƒ…å ±
- **ä¸»è¦ãƒ•ã‚¡ã‚¤ãƒ«**: masterfile.md (ä»•æ§˜)ã€ã“ã® claude.md (ç¾åœ¨ä»•æ§˜)
- **å®Ÿè£…é€²æ—**: docs/architecture/IMPLEMENTATION_STATUS.md
- **ä¸»è¦ã‚µãƒ¼ãƒ“ã‚¹**: app/src/main/services/ (å…¨ã‚µãƒ¼ãƒ“ã‚¹ç¾¤)
- **UI ã‚¨ãƒ³ãƒˆãƒª**: app/src/renderer/components/DashboardRefactored.tsx

---

**ã“ã®æ–‡æ›¸ã¯ gijiroku-app-v2 ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®å…¨ä½“æ§‹æˆãƒ»å®Ÿè£…ä»•æ§˜ã®Single Source of Truthã¨ã—ã¦ä½œæˆã•ã‚Œã¾ã—ãŸã€‚é–‹ç™ºãƒ»å¼•ãç¶™ããƒ»Claude Code ã§ã®çµ±åˆä½œæ¥­ã«ãŠã‘ã‚‹åŒ…æ‹¬çš„ãªã‚¬ã‚¤ãƒ‰ã¨ã—ã¦åˆ©ç”¨ã—ã¦ãã ã•ã„ã€‚**

*æœ€çµ‚æ›´æ–°: 2025-08-29 - AIProcessingServiceçµ±åˆãƒ»ã‚ªãƒ•ãƒ©ã‚¤ãƒ³å„ªå…ˆå‡¦ç†å®Œæˆ*
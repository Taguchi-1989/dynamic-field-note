# Dynamic Field Note - Dev Container Dockerfile
# ãƒã‚¤ãƒ‘ã‚¹å®Ÿè¡Œç’°å¢ƒç”¨ã®ã‚«ã‚¹ã‚¿ãƒ ã‚¤ãƒ¡ãƒ¼ã‚¸

FROM mcr.microsoft.com/devcontainers/typescript-node:1-20-bullseye

# ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’nodeã«è¨­å®š
USER node

# Claude Codeãƒã‚¤ãƒ‘ã‚¹å®Ÿè¡Œç”¨ã®ã‚¨ã‚¤ãƒªã‚¢ã‚¹è¨­å®š
# âš ï¸ ã“ã®ã‚¨ã‚¤ãƒªã‚¢ã‚¹ã¯Dev Containerå†…ã§ã®ã¿æœ‰åŠ¹ã§ã™
# âš ï¸ ãƒ›ã‚¹ãƒˆãƒžã‚·ãƒ³ã§ã¯é€šå¸¸ãƒ¢ãƒ¼ãƒ‰ï¼ˆæ‰¿èªå¿…è¦ï¼‰ã§å‹•ä½œã—ã¾ã™
RUN echo 'alias claude="claude --dangerously-skip-permissions"' >> ~/.bashrc && \
    echo 'alias claude="claude --dangerously-skip-permissions"' >> ~/.zshrc || true

# é–‹ç™ºåŠ¹çŽ‡åŒ–ç”¨ã®ã‚¨ã‚¤ãƒªã‚¢ã‚¹
RUN echo 'alias validate="npm run type-check && npm run lint && npm run format:check"' >> ~/.bashrc && \
    echo 'alias quicktest="npm run test:smoke"' >> ~/.bashrc && \
    echo 'alias fulltest="npm run validate && npm run test"' >> ~/.bashrc && \
    echo 'alias checkpoint="git add -A && git commit -m"' >> ~/.bashrc && \
    echo 'alias gdiff="git diff"' >> ~/.bashrc && \
    echo 'alias gstatus="git status"' >> ~/.bashrc && \
    echo 'alias cc="claude --dangerously-skip-permissions"' >> ~/.bashrc && \
    echo 'alias ccs="claude"' >> ~/.bashrc

# Gitè¨­å®šã®æœ€é©åŒ–
RUN git config --global core.autocrlf input && \
    git config --global init.defaultBranch main

# ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³è¨­å®šï¼ˆæ—¥æœ¬æ™‚é–“ï¼‰
ENV TZ=Asia/Tokyo

# Expo CLI ã®ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
USER root
RUN npm install -g expo-cli @expo/ngrok

# æ¨©é™ã‚’æˆ»ã™
USER node

# ã‚¦ã‚§ãƒ«ã‚«ãƒ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
RUN echo 'echo "ðŸš€ Dynamic Field Note Dev Container Ready!"' >> ~/.bashrc && \
    echo 'echo "ðŸ“ Claude Code bypass mode is ENABLED in this container"' >> ~/.bashrc && \
    echo 'echo "âš ï¸  Always run validate before commit: npm run validate"' >> ~/.bashrc && \
    echo 'echo ""' >> ~/.bashrc

WORKDIR /workspace

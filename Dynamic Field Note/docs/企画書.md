# 📘 現場動的要約・安全同期 出張報告アプリ

## ― マスター企画書（PoC → α → 本格展開） ―

---

## 1. プロジェクト概要

| 項目         | 内容                                                          |
| ---------- | ----------------------------------------------------------- |
| プロジェクト名    | **Dynamic Field Note（動的現場ノート）**                             |
| 開発目的       | 現場での音声・写真・メモを動的に構造化し、報告書作成を自動化する。<br>「喋りながら報告書ができる」環境を構築する。 |
| 主要プラットフォーム | **Azure**（Functions / Blob Storage / Graph API）             |
| 使用モデル      | **Gemini 2.5 Pro および GPT-5**（Fast→Quality 二段要約）             |
| デバイス       | iPhone 12 （PoC環境）、Android / 防爆タブレット （将来）                    |
| 開発方針       | OSS優先（MIT／Apache 2.0）、商用利用可、再販可設計                           |
| 開発手法       | アジャイル（PoC→α→β 段階的開発）                                        |

---

## 2. コンセプトと目的

### コンセプト

> 「現場で 95 %、オフィスで 5 % 仕上げる報告書」

音声入力と写真をリアルタイム構造化し、Markdown レポートとして即時生成。
通信制約やセキュリティを考慮し、**オフラインでも安全運用可能**な構成を採用する。

### 目的

* 出張報告書・議事録作成負荷の大幅削減（ 70 % 以上）
* 記録精度と統一性の向上（現場記録の抜け漏れ防止）
* クラウド連携による即時共有と分析基盤化

---

## 3. システム全体構成（アーキテクチャ）

```mermaid
flowchart LR
  subgraph Device[iPhone / Android / 防爆端末]
    MIC[音声入力(Gboard/iOS標準)]
    TEXTBUF[テキストバッファ(5秒更新)]
    TRIGGER[5分/無音検知→送信]
    CAM[カメラ撮影+注釈]
    DB[(SQLite + FileSystem)]
    PREVIEW[Markdownプレビュー]
    SYNC[同期キュー / ZIP生成]
  end

  subgraph BFF[Azure Functions]
    AI1[Gemini 2.5 Pro (Fast)]
    AI2[GPT-5 (Quality)]
    STRUCT[構造化/要約(JSON+MD)]
    CDR[CDR/ウイルス検査]
  end

  subgraph Storage[Azure Blob / SharePoint / OneDrive]
    FILES[MD/JSON/Photos/ZIP]
    LOGS[監査ログ(WORM)]
  end

  MIC-->TEXTBUF-->TRIGGER-->BFF
  CAM-->DB-->SYNC-->FILES
  BFF-->FILES
  BFF-->LOGS
```

---

## 4. 主機能一覧

| 区分             | 機能                        | 概要                       |
| -------------- | ------------------------- | ------------------------ |
| 🎙 音声入力        | 端末標準音声入力（Google／iOS）      | 5 秒単位で蓄積、5 分／無音30 秒で送信   |
| 🤖 二段要約        | Gemini 2.5 Pro → GPT-5 連携 | 「中間まとめ」→「最終構造化」          |
| 📸 写真撮影        | Expo Camera＋注釈            | 丸・矢印・テキスト描画、EXIF時刻自動付与   |
| 🧠 Markdown構造化 | LLM出力をJSON→MDパッチ反映        | 決定事項・ToDo・課題を整理          |
| ☁️ 同期          | 手動／自動（Wi-Fi 時）            | Azure Blob / Graph API経由 |
| 🔐 セキュリティ      | TLSピンニング＋署名ZIP＋ログ監査       | 脱獄検知・BFF隔離構成             |
| 📄 出力          | Markdown / PDF / ZIP      | Puppeteerまたはreportlab出力  |

---

## 5. 開発ロードマップ（アジャイル計画）

| フェーズ           | 期間  | 目的                         | 主タスク                            | 検証項目           |
| -------------- | --- | -------------------------- | ------------------------------- | -------------- |
| **P0 環境構築**    | 1 週 | 開発基盤整備                     | VS Code＋Expo 環境構築／iPhone 12 ビルド | Expo動作／証明書管理   |
| **P1 PoC**     | 2 週 | 音声→要約→Markdown             | 標準音声入力／Gemini接続／LLM JSON化       | テキスト精度・API 安定性 |
| **P2 UI/UX整備** | 2 週 | プレビュー中心UI                  | 中間/最終要約ボタン／ハンバーガーメニュー           | UXテスト          |
| **P3 ローカル保存**  | 3 週 | 写真+注釈+ZIP                  | SQLite/JSZip 導入                 | 保存整合性          |
| **P4 Azure連携** | 3 週 | Blob Storage / Functions連携 | HTTPS通信・ピンニング・BFF構築             | 通信安全・再送制御      |
| **P5 α版統合**    | 2 週 | 総合統合／脆弱性試験                 | 監査ログ・WAF連携・PDF出力                | 負荷/異常検知        |
| **P6 β・運用化**   | 継続  | 導入展開・MDM                   | Intune登録／VPN化                   | 現場適用確認         |

---

## 6. リスク・対策・実施フェーズ

| リスク        | 対応策                               | 実施フェーズ |
| ---------- | --------------------------------- | ------ |
| 端末ハック・踏み台化 | BFF隔離、App-only Graph、TLSピンニング、MDM | P4–P5  |
| APIキー漏洩    | BFF管理／Key Vault 格納                | P1     |
| 騒音下誤認識     | 外付けマイク検証（MV88+ 等）                 | P1–P2  |
| 個人情報映り込み   | 手動モザイク／撮影警告                       | P3     |
| 公衆通信経由     | SIM無し／VPN限定／専用Wi-Fi               | P4     |
| データ破損      | ZIP署名／再送キュー                       | P3     |
| OSS脆弱性     | Dependabot／npm audit              | 継続     |

---

## 7. セキュリティ設計概要

| 項目    | 方針                                 |
| ----- | ---------------------------------- |
| 通信    | HTTPS + mTLS + TLS ピンニング           |
| 認証    | Azure AD / MSAL ＋ 短命トークン(DPoP)     |
| データ保管 | 端末：暗号化 FS ＋ SecureStore 鍵分離        |
| 構成    | BFF DMZ 層／Blob Storage App-only 接続 |
| 検査    | CDR + AV + 拡張子 検証                  |
| 監査    | WORM ログ + 監査可視化 Power BI           |
| 運用    | Intune MDM／VPN 通信制御／SIM無し構成        |

---

## 8. 使用モデルとAI構成

| モデル                | 用途                  | 特徴               |
| ------------------ | ------------------- | ---------------- |
| **Gemini 2.5 Pro** | 中間要約（高速／低コスト）       | 長文安定／並列処理／日英混在強い |
| **GPT-5**          | 最終構造化（高精度）          | 指示遵守・構造化出力に強い    |
| **構成**             | Fast → Quality 二段処理 | 5 分バッチ → 章立て最終整形 |

---

## 9. コスト試算（PoC〜α）

| 項目                 | 内容                        | 概算                           |
| ------------------ | ------------------------- | ---------------------------- |
| LLM API            | Gemini 2.5 Pro + GPT-5 併用 | $10 〜 30 /月（平均1 h/日処理）       |
| Azure Functions    | 従量課金                      | 約 ¥200 / 月 未満（PoC 規模）        |
| Azure Blob Storage | 数 GB /月                   | ¥100 〜 ¥300                  |
| 外付けマイク             | Shure MV88+ 等             | ¥20,000 前後（任意）               |
| 合計 (PoC)           | ―                         | **¥2 〜 3 万円 / 初期、以降¥数百〜千/月** |

---

## 10. OSS／ライセンス方針

| 区分    | 使用予定                                         | ライセンス | 商用可 |
| ----- | -------------------------------------------- | ----- | --- |
| フロント  | `react-native`, `expo`, `react-native-paper` | MIT   | ✅   |
| ストレージ | `expo-file-system`, `expo-sqlite`            | MIT   | ✅   |
| 圧縮    | `jszip`                                      | MIT   | ✅   |
| 要約通信  | `@google/generative-ai`, `openai`            | 商用可   | ✅   |
| PDF   | `react-native-pdf-lib`, `puppeteer`          | MIT   | ✅   |
| サーバ   | `express`, `ajv`, `axios`                    | MIT   | ✅   |

> GPL／AGPL 等の**再販制限ライセンスは不採用**。
> 代替OSSまたは自作モジュールで対応。

---

## 11. UIコンセプト

* **1 画面主義（プレビュー中心）**
* 入力エリアは小さく、**Markdownプレビューを画面 70–80 %**
* 右下に「中間まとめ」「最終まとめ」ボタン
* ハンバーガーメニュー：案件切替／AI設定／同期履歴／匿名化トグル
* AI実行状態を常時表示（🟢実行中／🟡待機）

---

## 12. データ構造概要

```plaintext
/cases/{CASE_ID}/
 ├ case.md
 ├ case.json
 ├ photos/
 │   ├ P001.jpg
 │   └ P001_annotated.jpg
 ├ export/
 │   └ case_YYYYMMDD.zip
 └ logs/
     └ actions.jsonl
```

---

## 13. 開発・運用ガイドライン

| 項目      | 方針                                       |
| ------- | ---------------------------------------- |
| 開発管理    | GitHub Project / Issue 分割管理              |
| CI/CD   | Azure DevOps Pipeline（lint／build／deploy） |
| バージョニング | PoC v0.x → α v1.x → β v2.x               |
| ドキュメント  | Markdown / Mermaid ベース（SSOT 維持）          |
| リリース    | 内部TestFlight／MDM配布                       |
| 運用モード   | オフライン可 ＋ 手動同期トリガ方式                       |

---

## 14. 今後の展開（β → 本番）

* **RAG連携**による過去報告参照・比較要約
* **チェックリストテンプレート生成**（安全／品質カテゴリ）
* **現場KPI ダッシュボード**（Azure Power BI 連携）
* **Teams Bot通知**（案件生成／報告完了）
* **多言語対応**（日本語／英語混在議事要約）

---

## 15. 次アクション

1. **PoCリポジトリ初期化（Expo + TypeScript）**
2. **Gemini 2.5 Pro 接続試験（5 分要約）**
3. **Markdown プレビューUI 原型** 作成
4. **Azure Functions 連携PoC**
5. **セキュリティ強化項目 (証明書 Pin + KeyVault)** 実装
6. **α版統合 → 運用試験 → リリース判定**

---

## 16. まとめ

> **Dynamic Field Note ＝ 現場からAIまでをつなぐ記録基盤。**

* iPhone／Android で動作する現場自動記録システム
* Gemini 2.5 Pro × GPT-5 による動的要約と構造化
* Azure 中心の安全アーキテクチャ（Blob + Functions + Graph）
* OSSベース・商用利用可・再販可能構成
* PoC → α → β → 本番 までの明確な道筋とリスク対応表完備

---

この企画書が**全フェーズのマスター文書（SSOT）**です。
ここから

* GitHub Project Issue テンプレート化、
* 各フェーズ分割、
* 仕様／テスト／セキュリティ文書派生
  を直接行えます。

ご希望があれば、このマスターを
📄 **PDF（表紙＋Azure 構成図付き社内提出版）**として整形し出力します。
生成しますか？
